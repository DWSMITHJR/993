<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>1997 Porsche 911 Carrera 4S - Dealer Admin</title>
    <meta name="description" content="Admin panel for managing the sale of a 1997 Porsche 911 Carrera 4S (993) - Last of the Air-Cooled Era">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/contact-new.css">
    <link rel="stylesheet" href="css/toast.css">
    <link rel="stylesheet" href="css/accessibility.css">
    <link rel="stylesheet" href="css/admin-dealers.css">
    <style>
        /* Dealer card styles */
        .dealer-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        
        .dealer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        
        .dealer-card.highlighted {
            animation: highlight 2s ease-out;
        }
        
        @keyframes highlight {
            0% { box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.5); }
            100% { box-shadow: 0 0 0 0 rgba(13, 110, 253, 0); }
        }
        
        /* Status badges */
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
        
        .status-not-contacted { background-color: #6c757d; color: white; }
        .status-contacted { background-color: #0d6efd; color: white; }
        .status-interested { background-color: #198754; color: white; }
        .status-not-interested { background-color: #dc3545; color: white; }
        .status-follow-up { background-color: #ffc107; color: #000; }
        
        /* Form styles */
        .form-required:after {
            content: ' *';
            color: #dc3545;
        }
        
        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1100;
        }
        
        /* Activity Form Styles */
        .activity-form-card {
            background: var(--card-bg, #1e1e1e);
            border: 2px solid var(--primary-color, #ffcc00);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: visible;
            margin-bottom: 2rem;
            z-index: 10;
        }
        
        .activity-form-card:hover {
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
        }
        
        .activity-form-title {
            color: #ffcc00;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 204, 0, 0.1);
            border-radius: 8px 8px 0 0;
            border-bottom: 2px solid var(--primary-color, #ffcc00);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
        }
        
        .activity-form-title i {
            font-size: 1.25em;
        }
        
        .activity-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 0;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-color, #e0e0e0);
            font-weight: 500;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-label i {
            color: var(--primary-color, #ffcc00);
            width: 1.25rem;
            text-align: center;
        }
        
        .required {
            color: #ff4d4f;
            margin-left: 0.25rem;
            font-size: 0.9em;
        }
        
        .input-with-icon {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .input-with-icon i {
            position: absolute;
            right: 12px;
            color: var(--text-muted, #999);
            pointer-events: none;
        }
        
        .form-control {
            width: 100%;
            padding: 0.6rem 1rem;
            padding-right: 2.5rem;
            background: var(--input-bg, #2a2a2a);
            border: 1px solid var(--input-border, #444);
            border-radius: 6px;
            color: var(--text-color, #e0e0e0);
            font-size: 0.95rem;
            transition: all 0.2s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        .form-control:focus {
            border-color: var(--primary-color, #ffcc00);
            box-shadow: 0 0 0 2px rgba(255, 204, 0, 0.2);
            outline: none;
        }
        
        .form-control::placeholder {
            color: var(--text-muted, #888);
        }
        
        select.form-control {
            background-image: none;
            padding-right: 2.5rem;
        }
        
        .textarea-container {
            position: relative;
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
            padding: 0.75rem 1rem;
            padding-bottom: 2rem;
        }
        
        .textarea-footer {
            position: absolute;
            bottom: 0.5rem;
            right: 1rem;
            font-size: 0.8rem;
            color: var(--text-muted, #888);
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color, #333);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.6rem 1.25rem;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .btn i {
            font-size: 0.9em;
        }
        
        .btn-primary {
            background: var(--primary-color, #ffcc00);
            color: #1a1a1a;
            border-color: var(--primary-color, #ffcc00);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0.75rem 1.5rem;
        }
        
        .btn-primary:hover {
            background: #e6b800;
            border-color: #e6b800;
            transform: translateY(-1px);
        }
        
        .btn-outline-secondary {
            background: transparent;
            color: var(--text-color, #e0e0e0);
            border: 1px solid var(--border-color, #555);
            padding: 0.75rem 1.5rem;
            transition: all 0.2s ease;
        }
        
        .btn-outline-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary-color, #ffcc00);
            color: var(--primary-color, #ffcc00);
            transform: translateY(-1px);
        }
        
        /* Light mode overrides */
        @media (prefers-color-scheme: light) {
            .activity-form-card {
                --card-bg: #ffffff;
                --border-color: #ffcc00;
                --text-color: #333333;
                --text-muted: #666666;
                --input-bg: #f8f9fa;
                --input-border: #ced4da;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            }
            
            .form-control:focus {
                background: #ffffff;
                border-color: var(--primary-color, #ffcc00);
            }
            
            .activity-form-title {
                color: #1a1a1a;
            }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .activity-form {
                gap: 1.25rem;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        /* Toast notifications */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
            align-items: flex-end;
            max-width: 350px;
        }
        
        .toast {
            background: #2a2a2a;
            color: #fff;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            position: relative;
            pointer-events: auto;
            max-width: 100%;
            overflow: hidden;
            border-left: 4px solid #4a4a4a;
            animation: slideIn 0.3s ease forwards;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .toast.toast-success {
            background: #2e7d32;
            border-left-color: #4caf50;
        }
        
        .toast.toast-error {
            background: #c62828;
            border-left-color: #f44336;
        }
        
        .toast.toast-warning {
            background: #ef6c00;
            border-left-color: #ff9800;
        }
        
        .toast.toast-info {
            background: #1565c0;
            border-left-color: #2196f3;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            to {
                transform: translateX(100%);
                opacity: 0;
                max-height: 0;
                margin-bottom: 0;
                padding-top: 0;
                padding-bottom: 0;
            }
        }
        
        /* Sticky Header Styles */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .sticky-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 2rem;
            background: rgba(0, 0, 0, 0.95);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            position: fixed;
            left: 0;
            right: 0;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.4);
            height: 70px;
        }
        
        .home-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #fff;
            text-decoration: none;
            font-size: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .home-link:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            text-decoration: none;
        }
        
        .home-link i {
            font-size: 1.1rem;
        }
        
        .content-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            padding: 100px 20px 20px; /* Increased top padding to account for fixed header */
        }
        
        .header-tabs {
            display: flex;
            gap: 0.5rem;
            margin-left: auto;
        }
        
        .header-tab {
            padding: 0.8rem 1.5rem;
            background: transparent;
            border: none;
            color: #ccc;
            font-weight: 500;
            font-size: 0.95rem;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .header-tab i {
            font-size: 1rem;
        }
        
        .header-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        
        .header-tab.active {
            background: rgba(255, 204, 0, 0.2);
            color: #ffcc00;
            font-weight: 600;
        }
        
        .header-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: #ffcc00;
            border-radius: 3px 3px 0 0;
        }
        
        .nav-tabs {
            display: none; /* Hide the old nav tabs */
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.5em;
            font-weight: 700;
            color: #ffcc00;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
        }
        
        .page-header {
            text-align: center;
            margin: 2rem auto;
            padding: 0;
            max-width: 100%;
        }
        
        .nav-links a {
            color: #ccc;
            text-decoration: none;
            font-size: 0.9em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: color 0.3s ease;
        }
        
        .nav-links a:hover, 
        .nav-links a.active {
            color: #ffcc00;
        }
        
        .hagerty-nav-button {
            background: #ffcc00;
            color: #000 !important;
            padding: 8px 15px;
            border-radius: 4px;
            font-weight: 600 !important;
            transition: all 0.3s ease;
        }
        
        .hagerty-nav-button:hover {
            background: #ffd633;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Container and Content Wrapper */
        .container {
            width: 100%;
            max-width: 100%;
            margin: 80px auto 0;
            padding: 0;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            text-align: center;
        }
        
        .content-wrapper {
            width: 100%;
            max-width: 80%;
            margin: 0 auto;
            padding: 0 20px;
            box-sizing: border-box;
            text-align: left;
        }
        
        /* Ensure all tab content is properly contained */
        .tab-content {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Cards should respect the 80% width */
        .card {
            width: 100%;
            max-width: 100%;
            margin: 0 auto 20px;
            box-sizing: border-box;
        }
        
        /* Dealers Tab Specific Styles */
        #dealers.tab-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 100%;
            padding: 0;
        }
        
        #dealers .card {
            width: 100%;
            max-width: 100%;
            margin: 0 auto 20px;
            box-sizing: border-box;
        }
        
        .dealers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            width: 100%;
        }
        
        /* Dealer card styles */
        .card {
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            background: rgba(30, 30, 30, 0.8);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            color: #e0e0e0;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .card-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-header strong {
            font-size: 1.1rem;
            color: #fff;
        }
        
        .card-body {
            padding: 1.25rem;
        }
        
        .card-text {
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card-text i {
            width: 20px;
            text-align: center;
            color: #6c757d;
        }
        
        .card-text a {
            color: #4dabf7;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .card-text a:hover {
            color: #74c0fc;
            text-decoration: underline;
        }
        
        .card-footer {
            background: rgba(0, 0, 0, 0.2);
            padding: 0.75rem 1.25rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .btn-group {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn {
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        
        .btn-outline-primary {
            border: 1px solid #4dabf7;
            color: #4dabf7;
            background: transparent;
        }
        
        .btn-outline-primary:hover {
            background: rgba(77, 171, 247, 0.1);
        }
        
        .btn-outline-secondary {
            border: 1px solid #6c757d;
            color: #6c757d;
            background: transparent;
        }
        
        .btn-outline-secondary:hover {
            background: rgba(108, 117, 125, 0.1);
        }
        
        .badge {
            padding: 0.35em 0.65em;
            font-size: 0.75em;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.25rem;
        }
        
        .bg-success {
            background-color: #2b8a3e !important;
        }
        
        .bg-warning {
            background-color: #e67700 !important;
        }
        
        .bg-danger {
            background-color: #c92a2a !important;
        }
        
        .text-white {
            color: #fff !important;
        }
        
        .dealer-details {
            padding: 15px;
            padding-top: 0;
        }
        
        .dealer-count {
            padding: 1rem;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dealer-count h3 {
            margin: 0;
            display: flex;
            align-items: center;
            color: #fff;
        }
        
        .dealer-count .badge {
            font-size: 0.8em;
            padding: 0.25em 0.6em;
            margin-left: 0.5rem;
        }
        
        .dealer-card {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #fff;
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .dealer-header {
                background: #1a1a2e;
                color: #fff;
                border-bottom: 1px solid #2a2a40;
            }
        }
        
        .dealer-actions {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        /* Dealer Grid Layout */
        .dealers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 0;
            padding: 20px 0;
        }
        
        .status-no-response { background: #e74c3c; color: #fff; }
        .status-not-contacted { background: #f39c12; color: #fff; }
        
        .contact-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .contact-link {
            color: #ccc;
            font-size: 1rem;
            transition: color 0.2s ease;
            text-decoration: none;
        }
        
        .contact-link:hover {
            color: var(--accent);
        }
        
        .dealer-info {
            font-size: 0.85rem;
            color: #bbb;
        }
        
        .dealer-info p {
            margin: 3px 0;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .dealer-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            justify-content: flex-end;
        }
        
        .dealer-notes {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #f1c40f;
            cursor: help;
        }
        
        .dealer-card .dealer-info {
            margin-bottom: 15px;
        }
        
        .dealer-card .dealer-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dealer-card .btn {
            padding: 6px 12px;
            font-size: 0.85rem;
            border-radius: 4px;
            transition: all 0.2s ease, 
                        transform 0.2s ease, 
                        box-shadow 0.2s ease;
        }
        
        .dealer-card .btn i {
            margin-right: 5px;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-active {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }
        
        .status-pending {
            background-color: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }
        
        .status-inactive {
            background-color: rgba(108, 117, 125, 0.2);
            color: #6c757d;
        }
        
        /* Activity Log Styling */
        .activity-log {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .activity-item {
            background: rgba(40, 40, 40, 0.8);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 3px solid var(--accent);
        }
        
        .activity-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .activity-type {
            font-weight: 600;
            color: var(--accent);
        }
        
        .activity-notes {
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 30px 20px;
            color: #888;
        }
        
        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #555;
        }
        
        .empty-state h3 {
            margin: 10px 0 5px;
            color: #ddd;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .dealers-grid {
                grid-template-columns: 1fr;
            }
            
            .dealer-actions {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .search-container {
                width: 100%;
            }
            
            .search-input {
                width: 100%;
            }
        }
        
        .search-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .search-input {
            padding: 8px 15px 8px 35px;
            border-radius: 20px;
            border: 1px solid #444;
            background: #333;
            color: #fff;
            width: 250px;
            font-size: 14px;
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            color: #888;
            font-size: 14px;
        }
        
        @media (max-width: 1200px) {
            .content-wrapper {
                max-width: 90%;
            }
        }
        
        @media (max-width: 768px) {
            .content-wrapper {
                max-width: 100%;
                padding: 90px 15px 20px; /* Ensure consistent top padding on mobile */
            }
            
            .container {
                margin-top: 70px;
            }
        }
        
        .nav-container {
            width: 100%;
            max-width: 100%;
            overflow-x: auto;
            margin: 0 auto 20px;
            padding: 0 20px;
            box-sizing: border-box;
        }

        /* Tab Styling */
        .nav-tabs {
            display: none; /* Hide the old nav tabs */
        }
        
        .nav-tab {
            background: none;
            border: none;
            color: #aaa;
            padding: 12px 20px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            border-radius: 6px 6px 0 0;
            transition: all 0.2s ease;
            white-space: nowrap;
            position: relative;
            border: 1px solid transparent;
            border-bottom: none;
            margin-bottom: -1px;
        }
        
        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }
        
        .nav-tab.active {
            background: #2a2a2a;
            color: #ffcc00;
            border-color: rgba(255, 255, 255, 0.1);
            border-bottom-color: #2a2a2a;
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: #ffcc00;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            width: 100%;
            margin: 0 auto;
            padding: 0 20px;
            box-sizing: border-box;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin: 0 auto 20px;
            width: 100%;
            max-width: 80%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .card h2 {
            margin-top: 0;
            color: #ffcc00;
            font-size: 1.5em;
            margin-bottom: 1em;
        }
        
        .spec-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }
        
        .spec-table th, 
        .spec-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .spec-table th {
            color: #ffcc00;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8em;
            letter-spacing: 0.5px;
        }
        
        .spec-table td {
            color: #fff;
        }
        
        .spec-table tr:last-child td {
            border-bottom: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Dealer Management Styling */
        .dealers-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 0 0.5rem;
        }
        
        .dealers-header h2 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--text-color);
        }
        
        .dealers-count {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .dealers-count .badge {
            font-size: 0.9rem;
            padding: 0.35rem 0.75rem;
            background: var(--primary-color);
            color: #1a1a1a;
            font-weight: 600;
        }
        
        .dealers-count .last-updated {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .dealers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .dealer-card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }
        
        .dealer-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background-color: var(--status-color, #666);
        }
        
        .dealer-name {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
            min-width: 0;
        }
        
        .dealer-name i {
            font-size: 1.1rem;
            color: var(--status-color, #666);
            flex-shrink: 0;
        }
        
        .dealer-name h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .dealer-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 0.5rem;
        }
        
        .last-contact {
            font-size: 0.8rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.25rem;
            white-space: nowrap;
        }
        
        .btn-edit {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-edit:hover {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-color);
        }
        
        .meta-item i {
            width: 16px;
            color: var(--text-muted);
            text-align: center;
        }
        
        .meta-item a {
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .meta-item a:hover {
            color: var(--primary-color);
        }
        
        .dealer-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: auto;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }
        
        .btn-action {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg-color);
            color: var(--text-muted);
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .btn-action:hover {
            background: var(--primary-color);
            color: #1a1a1a;
            transform: translateY(-1px);
        }
        
        /* Status badges */
        .status-badge {
            font-size: 0.7rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Dark mode adjustments */
        @media (prefers-color-scheme: dark) {
            .dealer-card {
                background: var(--card-bg-dark);
                border-color: var(--border-color-dark);
            }
            
            .dealer-header {
                background: var(--header-bg-dark);
                border-color: var(--border-color-dark);
            }
            
            .btn-action {
                background: var(--bg-color-dark);
            }
        }
        
        .search-container {
            position: relative;
            display: inline-block;
        }

        .search-input {
            padding: 8px 15px 8px 35px;
            border-radius: 20px;
            border: 1px solid #444;
            background: #333;
            color: #fff;
            width: 250px;
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
            font-size: 14px;
            pointer-events: none;
        }

        @media (max-width: 1200px) {
            .content-wrapper {
                max-width: 90%;
            }
            
            .search-input {
                width: 200px;
            }
        }
        
        .dealer-details {
            padding: 1.25rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        /* Dealer Attributes - Single Line Format */
        .dealer-attributes {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin: 0;
            font-size: 0.9rem;
        }
        
        .attribute-line {
            display: flex;
            align-items: flex-start;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
        }
        
        .attribute-label {
            font-weight: 600;
            color: var(--text-muted);
            min-width: 80px;
            flex-shrink: 0;
        }
        
        .attribute-value {
            flex: 1;
            color: var(--text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .attribute-value a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .attribute-value a:hover {
            text-decoration: underline;
        }
        
        /* Special handling for notes to allow wrapping */
        .attribute-line.notes {
            white-space: normal;
            display: block;
        }
        
        .attribute-line.notes .attribute-value {
            white-space: normal;
            display: inline;
        }
        
        /* Dealer title and phone in header */
        .dealer-title {
            flex: 1;
            min-width: 0;
        }
        
        .dealer-phone {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .dealer-phone i {
            margin-right: 4px;
            color: var(--primary-color);
        }
        
        /* Contact Information Styles */
        .contact-section h4,
        .address-section h4,
        .notes-section h4,
        .last-contact-section h4 {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin: 0 0 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .contact-section h4 i,
        .address-section h4 i,
        .notes-section h4 i,
        .last-contact-section h4 i {
            color: var(--primary-color);
        }
        
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .contact-item {
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
        }
        
        .contact-item i {
            color: var(--primary-color);
            margin-top: 0.2rem;
            min-width: 20px;
            text-align: center;
        }
        
        .contact-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.2rem;
        }
        
        .contact-value {
            font-size: 0.9rem;
            color: var(--text-color);
            word-break: break-word;
        }
        
        .contact-value a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .contact-value a:hover {
            text-decoration: underline;
        }
        
        /* Notes Section */
        .notes-section {
            background: rgba(0, 0, 0, 0.03);
            border-radius: 6px;
            padding: 1rem;
            margin-top: 0.5rem;
        }
        
        .notes-content {
            font-size: 0.9rem;
            line-height: 1.5;
            color: var(--text-color);
            white-space: pre-wrap;
        }
        
        /* Last Contact Section */
        .last-contact-section .contact-item {
            background: rgba(0, 0, 0, 0.03);
            border-radius: 6px;
            padding: 0.75rem 1rem;
            margin-top: 0.5rem;
        }
        
        /* Dealer Footer */
        .dealer-footer {
            padding: 1rem 1.5rem;
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .footer-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-action {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.8rem;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-action:hover:not(:disabled) {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: #fff;
        }
        
        .btn-action:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .dealer-id {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            color: #fff;
            margin-left: 0.5rem;
            vertical-align: middle;
        }
        
        .dealer-details p {
            margin: 0.5rem 0;
            color: #ddd;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .dealer-details i {
            color: #ffcc00;
            width: 20px;
            text-align: center;
        }
        
        .dealer-details a {
            color: #ffcc00;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .dealer-details a:hover {
            text-decoration: underline;
            opacity: 0.9;
        }
        
        .dealer-notes {
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            font-size: 0.9rem;
            color: #bbb;
        }
        
        .dealer-notes p {
            margin: 0;
        }
        
        .dealer-actions {
            margin-top: 1rem;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            position: relative;
            z-index: 2;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dealer-actions .btn {
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }

        .dealer-actions .btn:hover {
            opacity: 1;
        }
        
        .btn-edit {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .btn-edit:hover {
            background: linear-gradient(135deg, #3a7bc8, #2c6098);
            transform: translateY(-1px);
        }
        
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            grid-column: 1 / -1;
            color: #aaa;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: #ffcc00;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .dealers-grid {
                grid-template-columns: 1fr;
            }
            
            .dealer-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .dealer-actions {
                justify-content: center;
            }
        }
        
        /* Dealer List Styling */
        .dealer-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 3px solid #ffcc00;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .dealer-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .dealer-number {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            height: 40px;
            background: #ffcc00;
            color: #1a1a1a;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.2em;
            font-family: 'Montserrat', sans-serif;
        }
        
        .dealer-info {
            flex: 1;
        }
        
        .dealer-info h4 {
            margin: 0 0 8px 0;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-badge {
            font-size: 0.7em;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-not-contacted {
            background: #444;
            color: #aaa;
        }
        
        .status-contacted {
            background: #ffcc00;
            color: #1a1a1a;
        }
        
        .status-followup {
            background: #ff9900;
            color: #1a1a1a;
        }
        
        .status-scheduled {
            background: #00cc66;
            color: #1a1a1a;
        }
        
        .status-declined {
            background: #ff3333;
            color: white;
        }
        
        .dealer-info p {
            margin: 4px 0;
            color: #ddd;
            font-size: 0.95em;
        }
        
        .dealer-info .notes {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 204, 0, 0.2);
            color: #aaa;
            font-style: italic;
        }
        
        .dealer-info a {
            color: #ffcc00;
            text-decoration: none;
        }
        
        .dealer-info a:hover {
            text-decoration: underline;
        }
        
        /* Layout Styling */
        .container {
            width: 100%;
            max-width: 100%;
            padding: 20px 0;
            margin: 0 auto;
            box-sizing: border-box;
        }
        
        .content-wrapper {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            box-sizing: border-box;
        }
        
        .nav-container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto 20px;
            padding: 0 10%;
            box-sizing: border-box;
        }
        
        
        .activity-dealer {
            font-weight: 600;
            color: #ffcc00;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .activity-date {
            color: #aaa;
            font-size: 0.85em;
            background: rgba(0,0,0,0.3);
            padding: 2px 8px;
            border-radius: 12px;
        }
        
        .activity-type {
            display: inline-block;
            font-size: 0.8em;
            padding: 2px 10px;
            border-radius: 12px;
            margin-right: 8px;
            background: #333;
            color: #ddd;
        }
        
        .activity-notes {
            background: rgba(255, 204, 0, 0.08);
            padding: 12px 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 3px solid rgba(255, 204, 0, 0.5);
            position: relative;
            line-height: 1.5;
        }
        
        .activity-notes:before {
            content: '💬';
            position: absolute;
            left: -30px;
            top: 10px;
            opacity: 0.6;
        }
        
        .activity-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
            margin-top: 8px;
        }
        
        .status-not-contacted { background: #444; color: #aaa; }
        .status-contacted { background: rgba(255, 204, 0, 0.2); color: #ffcc00; }
        .status-followup { background: rgba(255, 153, 0, 0.2); color: #ff9900; }
        .status-scheduled { background: rgba(0, 204, 102, 0.2); color: #00cc66; }
        .status-declined { background: rgba(255, 51, 51, 0.2); color: #ff6b6b; }
        
        /* Toast Notifications */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 350px;
        }
        
        .toast {
            background: #2a2a2a;
            color: #fff;
            padding: 12px 20px;
            margin-bottom: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            border-left: 4px solid #666;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease forwards;
        }
        
        .toast-success {
            border-left-color: #00c853;
        }
        
        .toast-error {
            border-left-color: #ff3d00;
        }
        
        .toast-warning {
            border-left-color: #ff9100;
        }
        
        .toast-info {
            border-left-color: #00b0ff;
        }
        
        .toast.fade-out {
            animation: fadeOut 0.3s ease forwards;
        }
        
        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }
        
        /* Form Controls */
        .form-group {
            margin-bottom: 1.2rem;
        }
        
        .form-control {
            display: block;
            width: 100%;
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: #fff;
            background-color: #2a2a2a;
            background-clip: padding-box;
            border: 1px solid #444;
            border-radius: 0.25rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        .form-control:focus {
            border-color: #ffcc00;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(255, 204, 0, 0.25);
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            font-weight: 500;
            line-height: 1.5;
            text-align: center;
            text-decoration: none;
            white-space: nowrap;
            vertical-align: middle;
            cursor: pointer;
-webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
            border: 1px solid transparent;
            border-radius: 0.25rem;
            transition: all 0.2s ease-in-out;
        }
        
        .btn i {
            margin-right: 0.5rem;
        }
        
        .btn-primary {
            color: #1a1a1a;
            background-color: #ffcc00;
            border-color: #ffcc00;
        }
        
        .btn-primary:hover {
            background-color: #e6b800;
            border-color: #d9b300;
        }
        
        .btn-outline-secondary {
            color: #ddd;
            border-color: #666;
            background-color: transparent;
        }
        
        .btn-outline-secondary:hover {
            background-color: #444;
            border-color: #888;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            line-height: 1.5;
            border-radius: 0.2rem;
        }
        
        /* Document Grid */
        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .document-category {
            background: #2a2a2a;
            border-radius: 0.4rem;
            padding: 0.8rem 1rem;
            border-left: 2px solid #ffcc00;
            margin-bottom: 1rem;
        }
        
        .document-category h3 {
            margin: 0 0 0.6rem 0;
            color: #ffcc00;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .document-item {
            margin: 0.3rem 0;
            padding: 0.5rem 0.6rem;
            background: #2d2d2d;
            border-radius: 0.2rem;
            transition: all 0.15s ease;
        }
        
        .document-item:hover {
            background: #3a3a3a;
            transform: translateX(3px);
        }
        
        .document-item label {
            display: flex;
            align-items: center;
            cursor: pointer;
            margin: 0;
        }
        
        .document-name {
            flex: 1;
            margin: 0 0.5rem;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .document-status {
            font-size: 0.75rem;
            color: #888;
            margin-left: 0.5rem;
            white-space: nowrap;
        }
        
        /* Upload Area */
        .upload-area {
            border: 2px dashed #555;
            border-radius: 0.5rem;
            padding: 2rem 1rem;
            text-align: center;
            margin: 1.5rem 0;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #ffcc00;
            background: rgba(255, 204, 0, 0.05);
        }
        
        .upload-area i {
            color: #ffcc00;
            margin-bottom: 1rem;
        }
        
        .upload-area p {
            margin: 0.5rem 0;
            font-size: 1.1rem;
        }
        
        .upload-area small {
            color: #888;
            font-size: 0.85rem;
        }
        
        /* Recent Uploads */
        .recent-uploads {
            margin-top: 2rem;
        }
        
        .recent-uploads h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: #ddd;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .no-files {
            text-align: center;
            padding: 2rem 1rem;
            color: #666;
            border: 1px dashed #444;
            border-radius: 0.5rem;
        }
        
        .no-files i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            opacity: 0.7;
        }
        
        .no-files p {
            margin: 0.5rem 0 0;
        }
        
        /* Document Actions */
        .document-actions {
            display: flex;
            gap: 0.6rem;
            margin-top: 1rem;
            padding-top: 1.5rem;
            border-top: 1px solid #333;
        }
        
        /* Email Template */
        .email-template {
            background: #2a2a2a;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1rem;
        }
        
        .email-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #444;
        }
        
        .email-content {
            line-height: 1.6;
        }
        
        .email-content h4 {
            margin: 1.5rem 0 0.75rem;
            color: #ffcc00;
        }
        
        .email-content ul, .email-content ol {
            padding-left: 1.5rem;
            margin: 0.75rem 0;
        }
        
        .email-content li {
            margin-bottom: 0.5rem;
        }
        
        .vehicle-highlights {
            background: rgba(255, 204, 0, 0.05);
            border-left: 3px solid #ffcc00;
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        
        .vehicle-highlights h4 {
            margin-top: 0;
            color: #ffcc00;
            font-size: 1.1rem;
        }
        
        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .documents-grid {
                grid-template-columns: 1fr;
            }
            
            .document-actions {
                flex-direction: column;
            }
            
            .document-actions .btn {
                width: 100%;
                margin: 0.2rem 0;
                padding: 0.25rem 0.5rem;
                font-size: 0.8rem;
            }
            
            .nav-tabs {
                justify-content: flex-start;
                padding-bottom: 5px;
            }
            
            .nav-tab {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .card {
                padding: 15px;
            }
            
            .spec-table th,
            .spec-table td {
                padding: 8px 10px;
                font-size: 0.9em;
            }
            
            .page-header h1 {
                font-size: 1.5em;
                margin-bottom: 0.5em;
            }
            
            .page-header p {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div id="toast-container"></div>
    <div class="scanline"></div>
    
    <header class="main-header">
        <nav class="sticky-nav">
            <div class="logo">Porsche 911 Carrera 4S</div>
            <a href="index.html" class="home-link">
                <i class="fas fa-home"></i> Home
            </a>
        </nav>
    </header>
    
    <div class="container">
        <div class="content-wrapper">
            <header class="page-header">
                <div class="page-header-top">
                    <h1>🏢 Dealer Contacts</h1>
                    <div class="vehicle-info">
                        <p>1997 Porsche 911 Carrera 4S • Last of the Air-Cooled Era • VIN: WPOAA2998VS320631 • White/Maroon</p>
                    </div>
                </div>
            </header>


            <!-- Details Tab -->
            <div id="details" class="tab-content active">
                <div class="card">
                    <h2>🎯 Quick Stats & Vehicle Details</h2>
                    <div class="details-grid">
                        <div class="details-section">
                            <h3>📊 Key Statistics</h3>
                            <table class="spec-table">
                                <tr>
                                    <td>Current Mileage</td>
                                    <td>~135,000 miles</td>
                                </tr>
                                <tr>
                                    <td>Production Rarity</td>
                                    <td>627 units in 1997</td>
                                </tr>
                                <tr>
                                    <td>Expected Price Range</td>
                                    <td>$185,000 - $225,000</td>
                                </tr>
                                <tr>
                                    <td>Est. Sale Timeline</td>
                                    <td>45-60 days (collector market)</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2>⏱️ Selling Timeline</h2>
                    <table class="data-table">
                        <tr>
                            <th>Sale Method</th>
                            <th>Timeline</th>
                        </tr>
                        <tr>
                            <td><strong>Private Sale</strong></td>
                            <td>30–60 days average for collector Porsche</td>
                        </tr>
                        <tr>
                            <td><strong>Consignment Dealer</strong></td>
                            <td>2–8 weeks (depends on buyer network)</td>
                        </tr>
                        <tr>
                            <td><strong>Auction</strong></td>
                            <td>2–4 weeks from listing to close</td>
                        </tr>
                        <tr>
                            <td><strong>Direct Sale to Dealer</strong></td>
                            <td>1–3 days (fastest, lowest payout)</td>
                        </tr>
                    </table>
                </div>
                
                <div class="card">
                    <h2>📅 Sample 8-Week Timeline</h2>
                    <table class="price-table">
                        <thead>
                            <tr>
                                <th>Week</th>
                                <th>Activity</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Valuation, inspection, detailing</td>
                                <td><span class="status-interested">In Progress</span></td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>Photography, listing creation</td>
                                <td><span class="status-contacted">Planned</span></td>
                            </tr>
                            <tr>
                                <td>3–6</td>
                                <td>Marketing, buyer outreach, showings</td>
                                <td><span class="status-no-response">Pending</span></td>
                            </tr>
                            <tr>
                                <td>7</td>
                                <td>Offer accepted, payment secured</td>
                                <td><span class="status-no-response">Pending</span></td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>Title transfer, delivery</td>
                                <td><span class="status-no-response">Pending</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="details-grid">
                    <div class="details-section">
                            <h3>🔧 Specifications</h3>
                            <table class="spec-table">
                                <tr>
                                    <td>Model</td>
                                    <td>911 Carrera 4S (993)</td>
                                </tr>
                                <tr>
                                    <td>Year</td>
                                    <td>1997</td>
                                </tr>
                                <tr>
                                    <td>Engine</td>
                                    <td>3.6L Flat-6 (285 HP)</td>
                                </tr>
                                <tr>
                                    <td>Transmission</td>
                                    <td>6-Speed Manual</td>
                                </tr>
                                <tr>
                                    <td>Exterior</td>
                                    <td>Polar Silver Metallic</td>
                                </tr>
                                <tr>
                                    <td>Interior</td>
                                    <td>Classic Gray Leather</td>
                                </tr>
                                <tr>
                                    <td>VIN</td>
                                    <td>WPOAA2998VS320631</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>📊 Sales Progress</h2>
                    <div class="progress-container">
                        <div class="progress-bar" id="salesProgress">
                            <div class="progress-fill" style="width: 25%;"></div>
                        </div>
                        <span class="progress-text">25% Complete</span>
                    </div>
                    
                    <div class="checklist" id="mainChecklist">
                        <h3>Sales Checklist</h3>
                        <label class="checklist-item">
                            <input type="checkbox" data-checklist="mainChecklist" data-index="0">
                            <span>Initial valuation completed</span>
                        </label>
                        <label class="checklist-item">
                            <input type="checkbox" data-checklist="mainChecklist" data-index="1">
                            <span>Professional detailing scheduled</span>
                        </label>
                        <label class="checklist-item">
                            <input type="checkbox" data-checklist="mainChecklist" data-index="2">
                            <span>Photography session booked</span>
                        </label>
                        <label class="checklist-item">
                            <input type="checkbox" data-checklist="mainChecklist" data-index="3">
                            <span>Dealer contacts initiated</span>
                        </label>
                        <label class="checklist-item">
                            <input type="checkbox" data-checklist="mainChecklist" data-index="4">
                            <span>Marketing materials prepared</span>
                        </label>
                        <label class="checklist-item">
                            <input type="checkbox" data-checklist="mainChecklist" data-index="5">
                            <span>Serious buyer identified</span>
                        </label>
                        <label class="checklist-item">
                            <input type="checkbox" data-checklist="mainChecklist" data-index="6">
                            <span>Negotiation completed</span>
                        </label>
                        <label class="checklist-item">
                            <input type="checkbox" data-checklist="mainChecklist" data-index="7">
                            <span>Sale finalized</span>
                        </label>
                    </div>
                </div>

                <div class="card">
                    <h2>💰 Market Value & Strategies</h2>
                    <div class="details-grid">
                        <div class="details-section">
                            <h3>📈 Market Valuation (as of September 2024)</h3>
                            <table class="spec-table">
                                <tr>
                                    <td>Hagerty #1 (Concours)</td>
                                    <td>$175,000 - $225,000</td>
                                </tr>
                                <tr>
                                    <td>Hagerty #2 (Excellent)</td>
                                    <td>$145,000 - $175,000</td>
                                </tr>
                                <tr>
                                    <td>Hagerty #3 (Good)</td>
                                    <td>$115,000 - $145,000</td>
                                </tr>
                                <tr>
                                    <td>Hagerty #4 (Fair)</td>
                                    <td>$85,000 - $115,000</td>
                                </tr>
                                <tr>
                                    <td>Recent BaT Average</td>
                                    <td>$162,500</td>
                                </tr>
                            </table>
                            <p class="text-muted mt-2"><small>Source: <a href="https://www.hagerty.com/valuation-tools/porsche/911/1997/1997-porsche-911-carrera_4s" target="_blank" rel="noopener noreferrer">Hagerty Valuation Tool</a></small></p>
                        </div>

                        <div class="details-section">
                            <h3>📋 Required Documents</h3>
                            <div class="document-category">
                                <ul class="checklist">
                                    <li class="document-item">
                                        <div class="document-info">
                                            <span class="document-name">Original Title</span>
                                            <span class="document-status">Required</span>
                                        </div>
                                    </li>
                                    <li class="document-item">
                                        <div class="document-info">
                                            <span class="document-name">Current Registration</span>
                                            <span class="document-status">Required</span>
                                        </div>
                                    </li>
                                    <li class="document-item">
                                        <div class="document-info">
                                            <span class="document-name">Service Records</span>
                                            <span class="document-status">Highly Recommended</span>
                                        </div>
                                    </li>
                                    <li class="document-item">
                                        <div class="document-info">
                                            <span class="document-name">Ownership History</span>
                                            <span class="document-status">Recommended</span>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <h3>🚀 Selling Strategies</h3>
                    <div class="strategy-comparison">
                        <div class="strategy-card">
                            <h4>🚀 Quick Sale</h4>
                            <p><strong>Price:</strong> $135K - $145K</p>
                            <p><strong>Time:</strong> 1-2 weeks</p>
                            <p><strong>Target Buyers:</strong> Local dealers, cash buyers</p>
                            <p><strong>Commission:</strong> 5-7%</p>
                            <p><strong>Best for:</strong> Quick liquidity, minimal hassle</p>
                        </div>
                        <div class="strategy-card">
                            <h4>🏆 Premium Private Sale</h4>
                            <p><strong>Price:</strong> $155K - $185K</p>
                            <p><strong>Time:</strong> 2-4 months</p>
                            <p><strong>Target Buyers:</strong> Enthusiasts, collectors</p>
                            <p><strong>Commission:</strong> 3-5% (broker)</p>
                            <p><strong>Best for:</strong> Maximizing value, finding the right buyer</p>
                        </div>
                        <div class="strategy-card">
                            <h4>💎 Premium Auction</h4>
                            <p><strong>Estimate:</strong> $145K - $195K</p>
                            <p><strong>Time:</strong> 4-8 weeks</p>
                            <p><strong>Platforms:</strong> Bring a Trailer, PCAR Market</p>
                            <p><strong>Fees:</strong> 5% (seller's premium) + listing</p>
                            <p><strong>Best for:</strong> Market exposure, competitive bidding</p>
                        </div>
                    </div>
                    
                    <div class="market-notes mt-4">
                        <h4>📝 Market Notes</h4>
                        <ul>
                            <li>Values for air-cooled 993 models, especially the C4S, have shown consistent appreciation</li>
                            <li>Low-mileage, well-documented examples command premium prices</li>
                            <li>Recent market shows strong demand for unmodified, original-condition vehicles</li>
                            <li>Consider pre-purchase inspection for premium sales</li>
                        </ul>
                    </div>
                </div>
            <div class="card">
                <h2>🔍 Vehicle Details</h2>
                
                <h3>🔧 Specifications</h3>
                <div class="spec-grid">
                    <div class="spec-item">
                        <strong>Model</strong>
                        911 Carrera 4S (993)
                    </div>
                    <div class="spec-item">
                        <strong>Year</strong>
                        1997
                    </div>
                    <div class="spec-item">
                        <strong>Engine</strong>
                        3.6L Flat-6 (285 HP)
                    </div>
                    <div class="spec-item">
                        <strong>Transmission</strong>
                        6-Speed Manual
                    </div>
                    <div class="spec-item">
                        <strong>Exterior</strong>
                        Polar Silver Metallic
                    </div>
                    <div class="spec-item">
                        <strong>Interior</strong>
                        Classic Gray Leather
                    </div>
                    <div class="spec-item">
                        <strong>Mileage</strong>
                        ~135,000 miles
                    </div>
                    <div class="spec-item">
                        <strong>VIN</strong>
                        WPOAA2998VS320631
                    </div>
                </div>

                <h3>💰 Market Value</h3>
                <div class="spec-grid">
                    <div class="spec-item">
                        <strong>Hagerty Valuation</strong>
                        $85,000 - $110,000
                    </div>
                    <div class="spec-item">
                        <strong>Bring a Trailer (avg.)</strong>
                        $92,500
                    </div>
                    <div class="spec-item">
                        <strong>PCAR Market Range</strong>
                        $95,000 - $120,000
                    </div>
                </div>

                <h3>📈 Selling Strategies</h3>
                <div class="strategy-comparison">
                    <div class="strategy-card">
                        <h4>🚀 Quick Sale</h4>
                        <p><strong>Price:</strong> $85K - $90K</p>
                        <p><strong>Time:</strong> 1-2 weeks</p>
                        <p><strong>Target Buyers:</strong> Local dealers, cash offers</p>
                        <p><strong>Commission:</strong> 8-10%</p>
                        <p><strong>Best For:</strong> Quick liquidity, convenience</p>
                    </div>
                    <div class="strategy-card">
                        <h4>🏆 Premium Sale</h4>
                        <p><strong>Price:</strong> $95K - $110K</p>
                        <p><strong>Time:</strong> 1-3 months</p>
                        <p><strong>Target Buyers:</strong> Collector market, enthusiasts</p>
                        <p><strong>Commission:</strong> 6-8%</p>
                        <p><strong>Best For:</strong> Maximizing sale price</p>
                    </div>
                    <div class="strategy-card">
                        <h4>💎 Auction</h4>
                        <p><strong>Estimate:</strong> $90K - $120K</p>
                        <p><strong>Time:</strong> 2-4 weeks</p>
                        <p><strong>Target Buyers:</strong> Nationwide collectors</p>
                        <p><strong>Fees:</strong> 5-7% + listing</p>
                        <p><strong>Best For:</strong> Market-driven pricing</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dealers Tab -->
        <div id="dealers" class="tab-content">
            <div class="card">
                <div class="dealer-header">
                    <h2><i class="fas fa-store-alt"></i> Dealer Management</h2>
                    <div class="dealer-actions">
                        <div class="search-container">
                            <input type="text" id="dealerSearch" placeholder="Search dealers..." class="search-input">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <button id="addDealerBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add Dealer
                        </button>
                    </div>
                </div>
                <div id="dealersList">
                    <!-- Dealer cards will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Activity Log Card -->
            <div class="card activity-form-card" id="logActivityForm">
                <h2 class="activity-form-title">
                    <i class="fas fa-plus-circle"></i> Log New Activity
                </h2>
                <div class="activity-form-container">
                    <form onsubmit="addActivity(event)" class="activity-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dealerSelect" class="form-label">
                                    <i class="fas fa-store"></i> Dealer
                                    <span class="required">*</span>
                                </label>
                                <div class="input-with-icon">
                                    <select id="dealerSelect" class="form-control" required>
                                        <option value="">Select a dealer...</option>
                                        <!-- Dealer options will be populated by JavaScript -->
                                    </select>
                                    <i class="fas fa-chevron-down select-arrow"></i>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="activityDate" class="form-label">
                                    <i class="far fa-calendar-alt"></i> Date
                                    <span class="required">*</span>
                                </label>
                                <div class="input-with-icon">
                                    <input type="date" id="activityDate" class="form-control" required>
                                    <i class="far fa-calendar-alt"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="activityType" class="form-label">
                                    <i class="fas fa-tasks"></i> Activity Type
                                    <span class="required">*</span>
                                </label>
                                <div class="input-with-icon">
                                    <select id="activityType" class="form-control" required>
                                        <option value="">Select activity type...</option>
                                        <option value="email">
                                            <i class="fas fa-envelope"></i> Email
                                        </option>
                                        <option value="call">
                                            <i class="fas fa-phone"></i> Phone Call
                                        </option>
                                        <option value="meeting">
                                            <i class="fas fa-handshake"></i> In-Person Meeting
                                        </option>
                                        <option value="test-drive">
                                            <i class="fas fa-car"></i> Test Drive
                                        </option>
                                        <option value="offer">
                                            <i class="fas fa-hand-holding-usd"></i> Made Offer
                                        </option>
                                        <option value="follow-up">
                                            <i class="fas fa-sync-alt"></i> Follow Up
                                        </option>
                                    </select>
                                    <i class="fas fa-chevron-down select-arrow"></i>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="followUpDate" class="form-label">
                                    <i class="far fa-bell"></i> Follow Up Date
                                </label>
                                <div class="input-with-icon">
                                    <input type="date" id="followUpDate" class="form-control">
                                    <i class="far fa-calendar-check"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="activityNotes" class="form-label">
                                <i class="far fa-sticky-note"></i> Notes
                                <span class="required">*</span>
                            </label>
                            <div class="textarea-container">
                                <textarea id="activityNotes" class="form-control" rows="4" placeholder="Enter activity details..." required></textarea>
                                <div class="textarea-footer">
                                    <span class="char-count">0/500</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-outline-secondary btn-reset">
                                <i class="fas fa-undo"></i> Clear Form
                            </button>
                            <button type="submit" class="btn btn-primary btn-save">
                                <i class="fas fa-save"></i> Save Activity
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Activity History -->
            <div class="card">
                <h2>📜 Activity History</h2>
                <div id="activityLog" class="activity-log">
                    <!-- Activity log entries will be inserted here by JavaScript -->
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <h3>No Activities Yet</h3>
                        <p>Log your first activity to see it here.</p>
                    </div>
                </div>
            </div>
                    <!-- Activity will be populated by JavaScript -->
                </div>
            </div>

            
        </div>
        </div>
    </div>

</div>

    <!-- Dealer Form Modal -->
    <div class="modal fade" id="dealerFormModal" tabindex="-1" aria-labelledby="dealerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="dealerModalTitle">Add New Dealer</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="dealerForm" onsubmit="return saveDealer(event)">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="dealerName" class="form-label">Dealer Name *</label>
                                    <input type="text" class="form-control" id="dealerName" name="name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="dealerStatus" class="form-label">Status</label>
                                    <select class="form-select" id="dealerStatus" name="status">
                                        <option value="not-contacted">Not Contacted</option>
                                        <option value="contacted">Contacted</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="no-response">No Response</option>
                                        <option value="not-interested">Not Interested</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="dealerAddress" class="form-label">Address</label>
                            <input type="text" class="form-control" id="dealerAddress" name="address">
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="dealerContact" class="form-label">Contact Person</label>
                                    <input type="text" class="form-control" id="dealerContact" name="contact">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="dealerPhone" class="form-label">Phone</label>
                                    <input type="tel" class="form-control" id="dealerPhone" name="phone">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="dealerEmail" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="dealerEmail" name="email">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="dealerSpecialty" class="form-label">Specialty</label>
                                    <input type="text" class="form-control" id="dealerSpecialty" name="specialty" placeholder="e.g., Porsche, Exotic, European">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="dealerNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="dealerNotes" name="notes" rows="3"></textarea>
                        </div>
                        
                        <div class="modal-footer border-secondary">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times me-1"></i> Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Save Dealer
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Helper Functions -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/toast.js"></script>
    <script src="js/dealers-admin.js"></script>
    <script src="js/admin.js"></script>
    <script>
    // Load dealer data from external file
    (function() {
        fetch('/data/dealers.json')
            .then(response => response.json())
            .then(data => {
                window.dealerData = data.dealers || [];
                console.log('Loaded', window.dealerData.length, 'dealers from dealers.json');
                // If we have the renderDealers function available, call it
                if (typeof renderDealers === 'function') {
                    renderDealers();
                }
            })
            .catch(error => {
                console.error('Error loading dealer data:', error);
                // Fallback to empty array if there's an error
                window.dealerData = [];
            });
    })();
    </script>
    <!-- Inline contact form handling -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('inquiry-form');
        if (!form) return;
        
        // Prevent context menu on form fields to avoid duplicate ID errors
        const formFields = form.querySelectorAll('input, textarea, select');
        formFields.forEach(field => {
            field.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                return false;
            }, false);
        });
        
        const emailInput = document.getElementById('email');
        const modal = document.getElementById('email-preview-modal');
        const closeModal = document.querySelector('.close-modal');
        const sendButton = document.getElementById('send-email');
        const editButton = document.getElementById('edit-email');
        const emailPreview = document.getElementById('email-preview');
        const submitButton = form.querySelector('button[type="submit"]');
        const buttonText = submitButton?.querySelector('.button-text');
        const buttonLoading = submitButton?.querySelector('.button-loading');

        // Email validation pattern
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        // Validate email format
        function validateEmail(email) {
            return emailRegex.test(email);
        }

        // Show error message
        function showError(input, message) {
            const formGroup = input.closest('.form-group');
            if (!formGroup) return;
            
            formGroup.classList.add('invalid');
            
            let error = formGroup.querySelector('.error-message');
            if (!error) {
                error = document.createElement('div');
                error.className = 'error-message';
                formGroup.appendChild(error);
            }
            
            error.textContent = message;
            input.focus();
        }

        // Remove error
        function removeError(input) {
            const formGroup = input.closest('.form-group');
            if (!formGroup) return;
            
            formGroup.classList.remove('invalid');
            const error = formGroup.querySelector('.error-message');
            if (error) {
                error.remove();
            }
        }

        // Validate form
        function validateForm() {
            let isValid = true;
            
            // Reset all errors
            form.querySelectorAll('.form-group').forEach(group => {
                group.classList.remove('invalid');
                const error = group.querySelector('.error-message');
                if (error) error.remove();
            });

            // Validate required fields
            const requiredFields = form.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    showError(field, 'This field is required');
                    isValid = false;
                } else if (field.type === 'email' && !validateEmail(field.value.trim())) {
                    showError(field, 'Please enter a valid email address');
                    isValid = false;
                }
            });

            return isValid;
        }

        // Close modal function
        function closeModalFunc() {
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // Handle form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!validateForm()) return;
            
            // Show loading state
            if (buttonText) buttonText.textContent = 'Sending...';
            if (buttonLoading) buttonLoading.style.display = 'inline-block';
            if (submitButton) submitButton.disabled = true;
            
            try {
                // In a real app, you would send this to your server
                // For now, we'll just simulate a successful submission
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Show success message
                if (typeof showToast === 'function') {
                    showToast('Your message has been sent successfully!', 'success');
                } else {
                    alert('Your message has been sent successfully!');
                }
                
                // Reset form
                form.reset();
                
            } catch (error) {
                console.error('Error submitting form:', error);
                if (typeof showToast === 'function') {
                    showToast('There was an error sending your message. Please try again.', 'error');
                } else {
                    alert('There was an error sending your message. Please try again.');
                }
            } finally {
                // Reset button state
                if (buttonText) buttonText.textContent = 'Send Message';
                if (buttonLoading) buttonLoading.style.display = 'none';
                if (submitButton) submitButton.disabled = false;
            }
        });
        
        // Close modal when clicking the X
        if (closeModal) {
            closeModal.addEventListener('click', closeModalFunc);
        }
        
        // Close modal when clicking outside the content
        if (modal) {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModalFunc();
                }
            });
        }
        
        // Initialize any other form-related functionality here
    });
    </script>
    <!-- Dealers admin functionality -->
    <script src="js/admin.js"></script>
    <script>
        // Show toast notification
       function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                console.error('Toast container not found');
                return;
            }
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            // Create toast content
            const toastContent = document.createElement('div');
            toastContent.className = 'toast-content';
            toastContent.textContent = message;
            toast.appendChild(toastContent);
            
            // Add close button
            const closeButton = document.createElement('button');
            closeButton.className = 'toast-close';
            closeButton.setAttribute('aria-label', 'Close');
            closeButton.innerHTML = '&times;';
            closeButton.addEventListener('click', () => dismissToast(toast));
            toast.appendChild(closeButton);
            
            // Add to container
            toastContainer.appendChild(toast);
            
            // Show the toast
            requestAnimationFrame(() => {
                setTimeout(() => {
                    toast.classList.add('show');
                    
                    // Auto-dismiss after 5 seconds
                    const dismissTimer = setTimeout(() => {
                        dismissToast(toast);
                    }, 5000);
                    
                    // Pause auto-dismiss on hover
                    toast.addEventListener('mouseenter', () => {
                        clearTimeout(dismissTimer);
                    });
                    
                    toast.addEventListener('mouseleave', () => {
                        setTimeout(() => {
                            dismissToast(toast);
                        }, 1000);
                    });
                }, 10);
            });
            
            return toast;
        }
        
        // Dismiss toast with animation
        function dismissToast(toast) {
            if (!toast || !toast.parentNode) return;
            
            toast.style.animation = 'fadeOut 0.3s ease forwards';
            
            // Remove from DOM after animation
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }

        // Sample documents data
        const sampleDocuments = {
            'Service Records': [
                { id: 'svc1', name: 'Complete Service History.pdf', date: '2023-10-10', size: '2.4 MB' },
                { id: 'svc2', name: 'Recent Maintenance Receipts.pdf', date: '2023-09-15', size: '1.8 MB' },
                { id: 'svc3', name: 'Warranty Information.pdf', date: '2023-08-20', size: '3.2 MB' }
            ],
            'Vehicle Photos': [
                { id: 'img1', name: 'Exterior Front View.jpg', date: '2023-10-05', size: '4.2 MB' },
                { id: 'img2', name: 'Interior Dashboard.jpg', date: '2023-10-05', size: '3.9 MB' },
                { id: 'img3', name: 'Engine Bay.jpg', date: '2023-10-05', size: '4.5 MB' },
                { id: 'img4', name: 'Wheels and Tires.jpg', date: '2023-10-05', size: '3.7 MB' }
            ],
            'Ownership Documents': [
                { id: 'own1', name: 'Title and Registration.pdf', date: '2023-01-15', size: '1.2 MB' },
                { id: 'own2', name: 'Bill of Sale.pdf', date: '2023-01-15', size: '0.9 MB' },
                { id: 'own3', name: 'Insurance Documents.pdf', date: '2023-10-01', size: '2.1 MB' }
            ],
            'Modifications': [
                { id: 'mod1', name: 'Performance Upgrades List.pdf', date: '2023-05-10', size: '1.5 MB' },
                { id: 'mod2', name: 'Receipts for Parts and Labor.pdf', date: '2023-05-10', size: '2.8 MB' },
                { id: 'mod3', name: 'Dyno Test Results.pdf', date: '2023-05-15', size: '1.1 MB' }
            ]
        };

        // Load documents into the documents tab
        function loadDocuments() {
            const documentsGrid = document.getElementById('documentsGrid');
            if (!documentsGrid) return; // Exit if the element doesn't exist
            
            documentsGrid.innerHTML = '';
            
            // Get documents from local storage or use sample data
            const documents = JSON.parse(localStorage.getItem('documents')) || sampleDocuments;
            
            // Create a grid of document categories
            Object.entries(documents).forEach(([category, items]) => {
                const categoryEl = document.createElement('div');
                categoryEl.className = 'document-category';
                
                let itemsHtml = '';
                items.forEach(doc => {
                    const fileExt = doc.name.split('.').pop().toLowerCase();
                    const fileIcon = getFileIcon(fileExt);
                    
                    itemsHtml += `
                        <div class="document-item">
                            <label>
                                <input type="checkbox" id="doc-${doc.id}">
                                <span class="document-icon">${fileIcon}</span>
                                <span class="document-name">${doc.name}</span>
                                <span class="document-status">${formatFileSize(doc.size)} • ${formatDate(doc.date)}</span>
                            </label>
                        </div>`;
                });
                
                categoryEl.innerHTML = `
                    <h3><i class="fas fa-folder"></i> ${category} (${items.length})</h3>
                    <div class="document-items">${itemsHtml}</div>
                    <div class="document-actions">
                        <button class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-download"></i> Download All
                        </button>
                        <button class="btn btn-sm btn-outline-danger">
                            <i class="fas fa-trash"></i> Delete Selected
                        </button>
                    </div>`;
                
                documentsGrid.appendChild(categoryEl);
            });
        }
        
        // Document upload functionality has been removed
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize authentication first
            const isAuth = await window.initAuth();
            if (!isAuth) return;
            // Data Storage
            let dealerData = JSON.parse(localStorage.getItem('dealerData')) || [
                {
                    id: 1,
                    name: "MotorCars of Atlanta",
                    phone: "(833) 722-1303",
                    website: "motorcarsofatlanta.com",
                    address: "7865 Roswell Rd, Atlanta, GA 30350",
                    contact: "Ethan Dilla",
                    status: "no-response",
                    notes: "Called and emailed info 9/12/25",
                    priority: 1
                },
                {
                    id: 2,
                    name: "Atlanta Autos",
                    phone: "(678) 213-4455",
                    website: "atlantaautos.com",
                    address: "1001 Cobb Pkwy N, Marietta, GA 30062",
                    contact: "",
                    status: "no-response",
                    notes: "Called in information 9/13/25",
                    priority: 2
                },
                {
                    id: 3,
                    name: "Gravity Autos Atlanta",
                    phone: "(404) 531-1815",
                    website: "gravityautosatlanta.com",
                    address: "5465 Peachtree Industrial Blvd, Atlanta, GA 30341",
                    contact: "",
                    status: "no-response",
                    notes: "Called 9/16/25, referred to Atlanta Autos",
                    priority: 3
                },
                {
                    id: 4,
                    name: "Atlantic Luxury Auto, LLC",
                    phone: "(678) 905-0054",
                    website: "atlanticluxuryautos.com",
                    address: "7100 Buford Hwy NE, Building A, Doraville, GA 30340",
                    contact: "",
                    status: "no-response",
                    notes: "Called 9/16/25 no answer",
                    priority: 4
                },
                {
                    id: 5,
                    name: "Cobb Luxury Cars",
                    phone: "(770) 575-0303",
                    website: "cobbluxurycars.com",
                    address: "1400 Atlanta Rd SE, Marietta, GA 30060",
                    contact: "",
                    status: "not-interested",
                    notes: "Not interested at this moment, try next week",
                    priority: 5
                },
                {
                    id: 6,
                    name: "Hennessy Porsche North Atlanta",
                    phone: "(770) 998-3000",
                    website: "hennessyporsche.com",
                    address: "11507 Alpharetta Hwy, Roswell, GA 30076",
                    contact: "",
                    status: "not-contacted",
                    notes: "Official Porsche dealer - strong for collector cars",
                    priority: 6
                },
                {
                    id: 7,
                    name: "Porsche Atlanta Perimeter",
                    phone: "(770) 390-0025",
                    website: "porscheatlantaperimeter.com",
                    address: "5505 Peachtree Dunwoody Rd, Atlanta, GA 30342",
                    contact: "",
                    status: "not-contacted",
                    notes: "Large inventory, certified pre-owned specialist",
                    priority: 7
                },
                {
                    id: 8,
                    name: "Porsche Atlanta Northwest",
                    phone: "(770) 726-0025",
                    website: "porscheatlantanorthwest.com",
                    address: "2890 Cobb Pkwy SE, Atlanta, GA 30339",
                    contact: "",
                    status: "not-contacted",
                    notes: "Over 400 Porsche models, 4.7/5 star rating",
                    priority: 8
                },
                {
                    id: 9,
                    name: "Porsche Atlanta Northeast",
                    phone: "(678) 574-3300",
                    website: "porscheatlantanortheast.com",
                    address: "3520 Mall Blvd, Duluth, GA 30096",
                    contact: "",
                    status: "not-contacted",
                    notes: "13-vehicle showroom, 21-bay service center",
                    priority: 9
                },
                {
                    id: 10,
                    name: "Exotic Motors Atlanta",
                    phone: "(770) 287-1000",
                    website: "exoticmotorsatlanta.com",
                    address: "3502 Browns Bridge Rd, Gainesville, GA 30501",
                    contact: "",
                    status: "not-contacted",
                    notes: "Exotic and luxury specialist",
                    priority: 10
                },
                {
                    id: 11,
                    name: "Merlin Auto Group",
                    phone: "(404) 228-8955",
                    website: "merlinautogroup.com",
                    address: "1655 Church St Ext NW, Marietta, GA 30060",
                    contact: "",
                    status: "not-contacted",
                    notes: "Ferrari, Porsche, and exotic car specialists",
                    priority: 11
                },
                {
                    id: 12,
                    name: "Bentley Atlanta",
                    phone: "(404) 467-0025",
                    website: "bentleyatlanta.com",
                    address: "5655 Peachtree Dunwoody Rd, Atlanta, GA 30342",
                    contact: "",
                    status: "not-contacted",
                    notes: "High-end luxury dealer, serves southeast region",
                    priority: 12
                },
                {
                    id: 13,
                    name: "European Auto Atlanta",
                    phone: "(404) 541-4222",
                    website: "europeanatl.com",
                    address: "2964 Peachtree Rd NW, Atlanta, GA 30305",
                    contact: "",
                    status: "not-contacted",
                    notes: "European luxury and exotic car specialist",
                    priority: 13
                },
                {
                    id: 14,
                    name: "Prestige Imports",
                    phone: "(855) 454-1227",
                    website: "prestigeimports.com",
                    address: "9077 Roswell Rd, Atlanta, GA 30350",
                    contact: "",
                    status: "not-contacted",
                    notes: "Lamborghini, Bentley, Rolls-Royce dealer",
                    priority: 14
                },
                {
                    id: 15,
                    name: "Classic AutoSmith",
                    phone: "(770) 457-5244",
                    website: "classicautosmith.com",
                    address: "2655 Dallas Hwy, Marietta, GA 30064",
                    contact: "",
                    status: "not-contacted",
                    notes: "Classic and collector car specialist",
                    priority: 15
                }
            ];

            let activityLog = JSON.parse(localStorage.getItem('activityLog')) || [
                {
                    date: new Date().toISOString().split('T')[0],
                    dealer: "MotorCars of Atlanta",
                    type: "email",
                    notes: "Sent detailed information about the 1997 Porsche 911 Carrera 4S. Included VIN, service history, and high-res photos. Awaiting valuation.",
                    status: "pending"
                },
                {
                    date: new Date(Date.now() - 86400000).toISOString().split('T')[0], // Yesterday
                    dealer: "European Auto Outlet",
                    type: "call",
                    notes: "Spoke with David in sales. Expressed strong interest in the car. Scheduled follow-up call for tomorrow at 2 PM.",
                    status: "in-progress"
                },
                {
                    date: new Date(Date.now() - 2 * 86400000).toISOString().split('T')[0], // 2 days ago
                    dealer: "Hennessy Porsche",
                    type: "meeting",
                    notes: "In-person meeting with sales manager. They're interested in consignment. Will send formal offer by end of week.",
                    status: "in-progress"
                },
                {
                    date: new Date(Date.now() - 3 * 86400000).toISOString().split('T')[0], // 3 days ago
                    dealer: "Global Imports BMW",
                    type: "email",
                    notes: "Received initial offer of $125,000. Countered with $145,000 based on recent market comps.",
                    status: "in-progress"
                },
                {
                    date: new Date(Date.now() - 4 * 86400000).toISOString().split('T')[0], // 4 days ago
                    dealer: "Mercedes-Benz of Buckhead",
                    type: "call",
                    notes: "Left voicemail with details. No callback yet.",
                    status: "no-response"
                },
                {
                    date: "2025-09-16",
                    dealer: "Cobb Luxury Cars",
                    type: "call",
                    notes: "Called back accidentally, said try next week",
                    status: "not-interested"
                },
                {
                    date: "2025-09-16",
                    dealer: "Atlantic Luxury Auto, LLC",
                    type: "call",
                    notes: "No answer",
                    status: "no-response"
                },
                {
                    date: "2025-09-16",
                    dealer: "Gravity Autos Atlanta",
                    type: "call",
                    notes: "Referred to Atlanta Autos - 678-343-1833",
                    status: "no-response"
                }
            ];

            // Initialize checklists object with all checkbox groups
            const checklists = {
                mainChecklist: document.querySelectorAll('#mainChecklist input[type="checkbox"]'),
                documentsChecklist: document.querySelectorAll('#documentsChecklist input[type="checkbox"]')
            };

            let checkboxData = {};

            // Function to save checkbox state to localStorage
            function saveCheckboxState(checkbox, listName = 'mainChecklist') {
                const id = checkbox.id || `checkbox-${Date.now()}`;
                if (!checkboxData[listName]) {
                    checkboxData[listName] = [];
                }
                
                const existingIndex = checkboxData[listName].findIndex(item => item.id === id);
                
                if (existingIndex >= 0) {
                    checkboxData[listName][existingIndex].checked = checkbox.checked;
                } else {
                    checkboxData[listName].push({
                        id: id,
                        checked: checkbox.checked
                    });
                }
                
                localStorage.setItem('checklistData', JSON.stringify(checkboxData));
                showToast('Changes saved', 'success');
            }
            
            // Function to load checkbox data from localStorage
            function loadCheckboxData() {
                try {
                    const savedData = localStorage.getItem('checklistData');
                    if (savedData) {
                        checkboxData = JSON.parse(savedData);
                    } else {
                        // Initialize with empty object if no data exists
                        checkboxData = {};
                    }
                    
                    // Ensure all checklists in the DOM are included in the data
                    const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
                    let needsUpdate = false;
                    
                    allCheckboxes.forEach((checkbox, idx) => {
                        const listName = checkbox.dataset.checklist || 'mainChecklist';
                        if (!checkboxData[listName]) {
                            checkboxData[listName] = [];
                            needsUpdate = true;
                        }
                        
                        // Set data-index if not already set
                        if (!checkbox.dataset.index) {
                            checkbox.dataset.index = idx.toString();
                            needsUpdate = true;
                        }
                    });
                    
                    // Save if we made any updates
                    if (needsUpdate) {
                        saveCheckboxData();
                    }
                    
                    updateCheckboxes();
                    showToast('Checklist data loaded', 'success');
                } catch (error) {
                    console.error('Error loading checkbox data:', error);
                    showToast('Error loading checklist data', 'error');
                }
            }

            // Function to update checkboxes based on loaded data
            function updateCheckboxes() {
                // Get all checkboxes in the document
                const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
                let updated = false;
                
                allCheckboxes.forEach((checkbox, index) => {
                    const listName = checkbox.dataset.checklist || 'mainChecklist';
                    const itemIndex = parseInt(checkbox.dataset.index || index);
                    
                    // Ensure the checklist exists in the data
                    if (!checkboxData[listName]) {
                        checkboxData[listName] = [];
                        updated = true;
                    }
                    
                    // Initialize the checkbox state if it doesn't exist
                    if (checkboxData[listName][itemIndex] === undefined) {
                        checkboxData[listName][itemIndex] = false;
                        updated = true;
                    }
                    
                    // Update the checkbox state
                    const wasChecked = checkbox.checked;
                    checkbox.checked = checkboxData[listName][itemIndex];
                    
                    // If the state changed, we need to update
                    if (wasChecked !== checkbox.checked) {
                        updated = true;
                    }
                    
                    // Ensure data-index is set
                    if (checkbox.dataset.index !== itemIndex.toString()) {
                        checkbox.dataset.index = itemIndex.toString();
                        updated = true;
                    }
                });
                
                // Save if we made any updates
                if (updated) {
                    saveCheckboxData();
                }
                
                // Update the progress display
                updateProgress();
            }

            // Function to save checkbox data to localStorage
            function saveCheckboxData() {
                try {
                    // Get all checkboxes in the document
                    const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
                    
                    allCheckboxes.forEach(checkbox => {
                        const listName = checkbox.dataset.checklist || 'mainChecklist';
                        const itemIndex = parseInt(checkbox.dataset.index);
                        
                        // Ensure the checklist exists in the data
                        if (!checkboxData[listName]) {
                            checkboxData[listName] = [];
                        }
                        
                        // Update the checkbox state in our data
                        checkboxData[listName][itemIndex] = checkbox.checked;
                    });
                    
                    // Save to localStorage
                    localStorage.setItem('checklistData', JSON.stringify(checkboxData));
                    return true;
                } catch (error) {
                    console.error('Error saving checkbox data:', error);
                    showToast('Error saving progress', 'error');
                    return false;
                }
            }

            // Add change event listeners to all checkboxes
            function setupCheckboxListeners() {
                const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    // Skip if already has a listener
                    if (checkbox.hasAttribute('data-has-listener')) {
                        return;
                    }
                    
                    // Mark as having a listener
                    checkbox.setAttribute('data-has-listener', 'true');
                    
                    // Add change listener with the item text
                    const itemText = checkbox.nextElementSibling?.textContent?.trim() || 
                                   checkbox.closest('label')?.textContent?.trim() || 
                                   'item';
                    
                    checkbox.addEventListener('change', (event) => handleCheckboxChange(event, itemText));
                });
            }
            
            function handleCheckboxChange(event, itemText) {
                const checkbox = event.target;
                const listName = checkbox.dataset.checklist || 'mainChecklist';
                const itemIndex = parseInt(checkbox.dataset.index);
                const isChecked = checkbox.checked;
                
                // Show toast notification
                const action = isChecked ? 'completed' : 'marked incomplete';
                showToast(`Item ${action}: ${itemText}`, 'success');
                
                // Save the state
                saveCheckboxState(checkbox, listName);
                
                // Ensure the checklist exists in the data
                if (!checkboxData[listName]) {
                    checkboxData[listName] = [];
                }
                
                // Get the previous state for comparison
                const wasChecked = checkboxData[listName][itemIndex] === true;
                
                // Only proceed if the state actually changed
                if (wasChecked !== isChecked) {
                    // Update the checkbox state in our data
                    checkboxData[listName][itemIndex] = isChecked;
                    
                    // Save the updated state
                    if (saveCheckboxData()) {
                        const action = isChecked ? 'completed' : 'marked incomplete';
                        const checklistTitle = checkbox.closest('.card') ? (checkbox.closest('.card').querySelector('h2') ? checkbox.closest('.card').querySelector('h2').textContent.trim() : 'Checklist') : 'Checklist';
                        const toastMessage = checklistTitle + ': ' + itemText + ' ' + action;
                        
                        // Show appropriate toast based on action
                        if (isChecked) {
                            showToast('✓ ' + toastMessage, 'success');
                        } else {
                            showToast('↩️ ' + toastMessage, 'info');
                        }
                        
                        updateProgress();
                    }
                }
            }

            // --- Tab Management ---
            const tabButtons = document.querySelectorAll('.nav-tab');
            const tabs = document.querySelectorAll('.tab-content');

            function showTab(tabId) {
                // Hide all tabs and remove active class from all buttons
                tabs.forEach(tab => {
                    tab.classList.remove('active');
                    tab.style.display = 'none';
                });
                
                // Show the selected tab and mark its button as active
                const activeTab = document.getElementById(tabId);
                if (activeTab) {
                    activeTab.style.display = 'block';
                    activeTab.classList.add('active');
                }
                
                // Update button states
                tabButtons.forEach(button => {
                    button.classList.toggle('active', button.dataset.tab === tabId);
                });
                
                // Save the active tab
                localStorage.setItem('lastActiveTab', tabId);
            }

            // Initialize tabs
            function initTabs() {
                // Add click handlers to all tab buttons
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => showTab(button.dataset.tab));
                });
                
                // Show the last active tab or default to the first tab
                const lastActiveTab = localStorage.getItem('lastActiveTab') || 'details';
                showTab(lastActiveTab);
            }
            
            // Initialize tabs when the page loads
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initTabs);
            } else {
                initTabs();
            }

            // --- Dealer Management ---
            const dealerList = document.getElementById('dealerList');
            const dealerSelect = document.getElementById('dealerSelect');
            const dealerSearch = document.getElementById('dealerSearch');
            const clearSearch = document.getElementById('clearSearch');
            const sortDealers = document.getElementById('sortDealers');
            const filterButtons = document.querySelectorAll('.dealer-filters [data-filter]');
            
            // Status configuration with icons and colors
            const statusConfig = {
                'not-contacted': { 
                    label: 'Not Contacted', 
                    icon: 'fa-envelope', 
                    color: '#9e9e9e',
                    bgColor: '#f5f5f5'
                },
                'contacted': { 
                    label: 'Contacted', 
                    icon: 'fa-check-circle', 
                    color: '#4caf50',
                    bgColor: '#e8f5e9'
                },
                'no-response': { 
                    label: 'No Response', 
                    icon: 'fa-envelope', 
                    color: '#ff9800',
                    bgColor: '#fff3e0'
                },
                'not-interested': { 
                    label: 'Not Interested', 
                    icon: 'fa-times-circle', 
                    color: '#f44336',
                    bgColor: '#ffebee'
                },
                'in-progress': { 
                    label: 'In Progress', 
                    icon: 'fa-spinner', 
                    color: '#2196f3',
                    bgColor: '#e3f2fd'
                }
            };
            
            // Current filter state
            let currentFilter = 'all';
            let currentSearchTerm = '';
            let currentSort = 'name-asc';
            
            // Initialize dealer functionality
            function initDealers() {
                // Load dealer data from localStorage if available
                try {
                    const savedData = localStorage.getItem('dealerData');
                    if (savedData) {
                        dealerData = JSON.parse(savedData);
                    }
                } catch (error) {
                    console.error('Error loading dealer data:', error);
                }
                
                loadDealers();
                setupEventListeners();
                populateDealerSelect();
                // Load any saved filter/sort preferences
                loadPreferences();
                
                // Add click handler for Add Dealer button
                const addDealerBtn = document.getElementById('addDealerBtn');
                if (addDealerBtn) {
                    addDealerBtn.addEventListener('click', () => openDealerForm());
                }
                
                // Setup form submission
                const dealerForm = document.getElementById('dealerForm');
                if (dealerForm) {
                    dealerForm.addEventListener('submit', saveDealer);
                }
            }
            
            // Set up event listeners
            function setupEventListeners() {
                // Search functionality
                if (dealerSearch) {
                    dealerSearch.addEventListener('input', (e) => {
                        currentSearchTerm = e.target.value.toLowerCase();
                        loadDealers();
                    });
                }
                
                // Clear search button
                if (clearSearch) {
                    clearSearch.addEventListener('click', () => {
                        if (dealerSearch) {
                            dealerSearch.value = '';
                            currentSearchTerm = '';
                            loadDealers();
                        }
                    });
                }
                
                // Filter buttons
                filterButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        // Update active state
                        filterButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        
                        // Set current filter
                        currentFilter = button.dataset.filter;
                        loadDealers();
                        savePreferences();
                    });
                });
                
                // Sort dropdown
                if (sortDealers) {
                    sortDealers.addEventListener('change', (e) => {
                        currentSort = e.target.value;
                        loadDealers();
                        savePreferences();
                    });
                }
            }
            
            // Load and display dealers with current filters and sort
            function loadDealers() {
                if (!dealerList) return;
                
                // Show loading state
                dealerList.innerHTML = `
                    <div class="text-center p-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p>Loading dealer contacts...</p>
                    </div>
                `;
                
                // Use setTimeout to allow the UI to update with loading state
                setTimeout(() => {
                    try {
                        // Filter dealers
                        let filteredDealers = [...dealerData];
                        
                        // Apply search filter
                        if (currentSearchTerm) {
                            filteredDealers = filteredDealers.filter(dealer => 
                                dealer.name.toLowerCase().includes(currentSearchTerm) ||
                                (dealer.contact && dealer.contact.toLowerCase().includes(currentSearchTerm)) ||
                                (dealer.notes && dealer.notes.toLowerCase().includes(currentSearchTerm)) ||
                                (dealer.address && dealer.address.toLowerCase().includes(currentSearchTerm))
                            );
                        }
                        
                        // Apply status filter
                        if (currentFilter !== 'all') {
                            filteredDealers = filteredDealers.filter(dealer => 
                                (dealer.status || 'not-contacted') === currentFilter
                            );
                        }
                        
                        // Sort dealers
                        filteredDealers = sortDealersList(filteredDealers, currentSort);
                        
                        // Display results
                        renderDealers(filteredDealers);
                        
                        // Add click handlers to dealer cards
                        document.querySelectorAll('.dealer-card').forEach(card => {
                            // Make the entire card clickable
                            card.style.cursor = 'pointer';
                            card.addEventListener('click', (e) => {
                                // Don't trigger if clicking on a button or link inside the card
                                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A' || e.target.closest('button') || e.target.closest('a')) {
                                    return;
                                }
                                const dealerId = parseInt(card.dataset.id);
                                editDealer(dealerId);
                            });
                        });
                        
                        // Add hover effect to dealer cards
                        const style = document.createElement('style');
                        style.textContent = `
                            .dealer-card {
                                transition: transform 0.2s ease, box-shadow 0.2s ease;
                            }
                            .dealer-card:hover {
                                transform: translateY(-2px);
                                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                                border: 1px solid rgba(255, 204, 0, 0.3);
                            }
                        `;
                        document.head.appendChild(style);
                        
                    } catch (error) {
                        console.error('Error loading dealers:', error);
                        dealerList.innerHTML = `
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle"></i>
                                Error loading dealer contacts. Please try again later.
                            </div>
                        `;
                    }
                }, 100); // Small delay to show loading state
            }
            
            // Sort dealers based on current sort option
            function sortDealersList(dealers, sortBy) {
                return [...dealers].sort((a, b) => {
                    switch(sortBy) {
                        case 'name-asc':
                            return a.name.localeCompare(b.name);
                        case 'name-desc':
                            return b.name.localeCompare(a.name);
                        case 'recent':
                            return new Date(b.lastContact || 0) - new Date(a.lastContact || 0);
                        case 'oldest':
                            const dateA = a.lastContact ? new Date(a.lastContact) : new Date(0);
                            const dateB = b.lastContact ? new Date(b.lastContact) : new Date(0);
                            return dateA - dateB;
                        default:
                            return a.priority - b.priority;
                    }
                });
            }
            
            // Render dealers function
            function renderDealers(dealers) {
                const dealersList = document.getElementById('dealersList');
                if (!dealersList) {
                    console.error('Dealers list element not found');
                    return;
                }
                
                // Remove existing event listeners
                document.querySelectorAll('.edit-dealer-btn').forEach(btn => {
                    btn.removeEventListener('click', handleEditDealerClick);
                });
                
                // Clear existing content
                dealersList.innerHTML = '';
                
                // Create a container for the grid
                const gridContainer = document.createElement('div');
                gridContainer.className = 'dealers-grid';
                dealersList.appendChild(gridContainer);
                
                // Add count of dealers
                const countHeader = document.createElement('div');
                countHeader.className = 'dealers-header';
                countHeader.innerHTML = `
                    <h2><i class="fas fa-store-alt"></i> Dealer Directory</h2>
                    <div class="dealers-count">
                        <span class="badge">${dealers.length} ${dealers.length === 1 ? 'Dealer' : 'Dealers'}</span>
                        <span class="last-updated">Last updated: ${new Date().toLocaleDateString()}</span>
                    </div>
                `;
                dealersList.insertBefore(countHeader, gridContainer);
                
                // Add status legend
                const legend = document.createElement('div');
                legend.className = 'status-legend';
                legend.innerHTML = `
                    <div class="legend-title">Status Legend:</div>
                    <div class="legend-items">
                        ${Object.entries(statusConfig).map(([key, config]) => 
                            `<span class="legend-item" style="--status-color: ${config.bgColor};">
                                <i class="fas ${config.icon}"></i> ${config.label}
                            </span>`
                        ).join('')}
                    </div>
                `;
                dealersList.insertBefore(legend, gridContainer);
                
                // Add click handler for dealer cards
                const handleDealerCardClick = (e) => {
                    const card = e.target.closest('.dealer-card');
                    if (!card) return;
                    
                    // Don't trigger if clicking on a link or button inside the card
                    if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON' || e.target.closest('a, button')) {
                        return;
                    }
                    
                    const dealerId = card.getAttribute('data-id');
                    if (dealerId) {
                        editDealer(dealerId);
                    }
                };
                
                // Add click handler for edit buttons
                const handleEditClick = (e) => {
                    const btn = e.target.closest('.btn-edit');
                    if (!btn) return;
                    
                    e.stopPropagation();
                    const dealerId = btn.getAttribute('data-id');
                    if (dealerId) {
                        editDealer(dealerId);
                    }
                };
                
                // Add event listeners
                gridContainer.addEventListener('click', handleDealerCardClick);
                gridContainer.addEventListener('click', handleEditClick);
                
                // Add dealer cards
                dealers.forEach(dealer => {
                    const status = dealer.status || 'not-contacted';
                    const statusInfo = statusConfig[status] || statusConfig['not-contacted'];
                    const lastContact = dealer.lastContact ? new Date(dealer.lastContact) : null;
                    const daysAgo = lastContact ? Math.floor((new Date() - lastContact) / (1000 * 60 * 60 * 24)) : null;
                    
                    const dealerEl = document.createElement('div');
                    dealerEl.className = 'dealer-card';
                    dealerEl.setAttribute('data-status', status);
                    dealerEl.setAttribute('data-id', dealer.id);
                    
                    // Format last contact date
                    const lastContactFormatted = lastContact 
                        ? `${lastContact.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} (${daysAgo}${daysAgo === 1 ? 'd' : 'd'})` 
                        : 'No contact';
                    
                    dealerEl.innerHTML = `
                        <div class="dealer-card-inner">
                            <div class="dealer-header" style="--status-color: ${statusInfo.bgColor};">
                                <div class="dealer-name">
                                    <i class="fas ${statusInfo.icon}"></i>
                                    <div class="dealer-title">
                                        <h3>${dealer.name}</h3>
                                        ${dealer.phone ? `<div class="dealer-phone"><i class="fas fa-phone"></i> ${dealer.phone}</div>` : ''}
                                    </div>
                                    <span class="status-badge" style="background: ${statusInfo.bgColor}">${statusInfo.label}</span>
                                </div>
                                <div class="dealer-actions">
                                    <span class="last-contact" title="Last contact: ${lastContactFormatted}">
                                        <i class="far fa-calendar"></i> ${lastContactFormatted}
                                    </span>
                                    <button class="btn-edit" data-id="${dealer.id}" title="Edit dealer">
                                        <i class="fas fa-pencil-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="dealer-details">
                                <!-- Dealer Attributes - Single Line Format -->
                                <div class="dealer-attributes">
                                    ${dealer.contactPerson ? `
                                        <div class="attribute-line">
                                            <span class="attribute-label">Contact:</span>
                                            <span class="attribute-value">${dealer.contactPerson}</span>
                                        </div>
                                    ` : ''}
                                    ${dealer.email ? `
                                        <div class="attribute-line">
                                            <span class="attribute-label">Email:</span>
                                            <a href="mailto:${dealer.email}" class="attribute-value">${dealer.email}</a>
                                        </div>
                                    ` : ''}
                                    ${dealer.website ? `
                                        <div class="attribute-line">
                                            <span class="attribute-label">Website:</span>
                                            <a href="${dealer.website.startsWith('http') ? '' : '//'}${dealer.website}" 
                                               target="_blank" rel="noopener noreferrer" class="attribute-value">
                                                ${dealer.website.replace(/^https?:\/\//, '')}
                                            </a>
                                        </div>
                                    ` : ''}
                                    ${dealer.specialty ? `
                                        <div class="attribute-line">
                                            <span class="attribute-label">Specialty:</span>
                                            <span class="attribute-value">${dealer.specialty}</span>
                                        </div>
                                    ` : ''}
                                    ${dealer.address ? `
                                        <div class="attribute-line">
                                            <span class="attribute-label">Address:</span>
                                            <a href="https://maps.google.com/?q=${encodeURIComponent(dealer.address)}" 
                                               target="_blank" rel="noopener noreferrer" class="attribute-value">
                                                ${dealer.address}
                                            </a>
                                        </div>
                                    ` : ''}
                                    ${dealer.notes ? `
                                        <div class="attribute-line notes">
                                            <span class="attribute-label">Notes:</span>
                                            <span class="attribute-value">${dealer.notes}</span>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            <!-- Footer with Actions -->
                            <div class="dealer-footer">
                                <div class="footer-actions">
                                    <button class="btn-action email-btn" data-email="${dealer.email || ''}" ${!dealer.email ? 'disabled' : ''}>
                                        <i class="fas fa-envelope"></i> Email
                                    </button>
                                    <button class="btn-action call-btn" data-phone="${dealer.phone || ''}" ${!dealer.phone ? 'disabled' : ''}>
                                        <i class="fas fa-phone"></i> Call
                                    </button>
                                    <button class="btn-action map-btn" data-address="${dealer.address || ''}" ${!dealer.address ? 'disabled' : ''}>
                                        <i class="fas fa-map-marker-alt"></i> Map
                                    </button>
                                </div>
                                <div class="dealer-id">ID: ${dealer.id}</div>
                            </div>
                        </div>
                    `;
                    dealerEl.dataset.id = dealer.id;
                    dealerEl.setAttribute('role', 'button');
                    dealerEl.setAttribute('tabindex', '0');
                    dealerEl.setAttribute('aria-label', `Edit ${dealer.name} details`);
                    
                    // Add click handler for the entire card
                    dealerEl.addEventListener('click', (e) => {
                        // Don't trigger if clicking on a link or button inside the card
                        if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON' || e.target.closest('a, button')) {
                            return;
                        }
                        // Open the edit modal when clicking the card
                        editDealer(dealer.id);
                    });
                    
                    // Add keyboard navigation
                    dealerEl.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            editDealer(dealer.id);
                        }
                    });
                    
                    // Add the dealer card to the grid
                    gridContainer.appendChild(dealerEl);
                    
                });

                // Add event delegation for dealer action buttons
                const dealersContainer = document.getElementById('dealersList');
                if (dealersContainer) {
                    dealersContainer.addEventListener('click', (e) => {
                        // Handle edit button clicks
                        const editBtn = e.target.closest('.edit-dealer');
                        if (editBtn) {
                            e.preventDefault();
                            e.stopPropagation();
                            const dealerId = parseInt(editBtn.dataset.dealerId);
                            if (!isNaN(dealerId)) {
                                editDealer(dealerId);
                            } else {
                                console.error('Invalid dealer ID on edit button:', editBtn.dataset.dealerId);
                            }
                            return;
                        }
                        
                        // Handle contact button clicks
                        const contactBtn = e.target.closest('.log-contact');
                        if (contactBtn) {
                            e.preventDefault();
                            e.stopPropagation();
                            const dealerId = parseInt(contactBtn.dataset.dealerId);
                            if (!isNaN(dealerId)) {
                                openContactModal(dealerId);
                            }
                            return;
                        }
                    });
                    
                    // Handle card clicks for editing (excluding buttons and links)
                    dealersContainer.addEventListener('click', (e) => {
                        const card = e.target.closest('.card[data-id]');
                        if (card && !e.target.closest('.btn') && !e.target.closest('a')) {
                            e.preventDefault();
                            const dealerId = parseInt(card.dataset.id);
                            if (!isNaN(dealerId)) {
                                editDealer(dealerId);
                            }
                        }
                    });
                    
                    // Add keyboard support for dealer cards
                    dealersContainer.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            const card = e.target.closest('.card[data-id]');
                            if (card) {
                                e.preventDefault();
                                const dealerId = parseInt(card.dataset.id);
                                if (!isNaN(dealerId)) {
                                    editDealer(dealerId);
                                }
                            }
                        }
                    });
                }
                
            }
            
            // Open contact modal for a specific dealer
            function openContactModal(dealerId) {
                const dealer = dealerData.find(d => d.id === dealerId);
                if (!dealer) {
                    console.error('Dealer not found:', dealerId);
                    return;
                }

                // Check if the dealersAdmin is available (from dealers-admin.js)
                if (window.dealersAdmin && typeof window.dealersAdmin.openContactModal === 'function') {
                    window.dealersAdmin.openContactModal(dealerId);
                    return;
                }

                // Fallback to the local function
                const dealerSelect = document.getElementById('dealerSelect');
                if (dealerSelect) {
                    dealerSelect.value = dealerId;
                    // Trigger change event in case there are dependent fields
                    dealerSelect.dispatchEvent(new Event('change'));
                }
                
                // Set the current date
                const today = new Date().toISOString().split('T')[0];
                const dateInput = document.getElementById('activityDate') || document.getElementById('contactDate');
                if (dateInput) {
                    dateInput.value = today;
                }
                
                // Set focus to the activity type or first input
                const activityType = document.getElementById('activityType') || 
                                   document.querySelector('.contact-form input, .contact-form select, .contact-form textarea');
                if (activityType) {
                    activityType.focus();
                }
                
                // Show the activity form (if hidden)
                const activityForm = document.querySelector('.contact-form, #activityForm');
                if (activityForm) {
                    activityForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    
                    // Highlight the dealer in the list
                    const dealerEl = document.querySelector(`.card[data-id="${dealerId}"], .dealer-card[data-id="${dealerId}"]`);
                    if (dealerEl) {
                        dealerEl.classList.add('highlighted');
                        setTimeout(() => {
                            dealerEl.classList.remove('highlighted');
                        }, 2000);
                    }
                }
                
                // Show success message
                showToast(`Ready to log activity for ${dealer.name}`, 'info');
            }
            
            // Handle edit dealer button click
            function handleEditDealerClick(event) {
                event.preventDefault();
                event.stopPropagation();
                const dealerId = parseInt(this.getAttribute('data-dealer-id'));
                editDealer(dealerId);
            }
            
            // Ensure Edit Dealer Modal exists (inject if missing)
            (function ensureEditDealerModal() {
                if (!document.getElementById('editDealerModal')) {
                    const editDealerModalHtml = `
                        <div class="modal fade" id="editDealerModal" tabindex="-1" aria-labelledby="editDealerModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header bg-primary text-white">
                                        <h5 class="modal-title" id="editDealerModalLabel">Edit Dealer</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="editDealerForm" class="needs-validation" novalidate>
                                            <input type="hidden" id="editDealerId" name="id" />
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="editDealerName" class="form-label">Dealer Name *</label>
                                                    <input type="text" class="form-control" id="editDealerName" name="name" required />
                                                    <div class="invalid-feedback">Please provide a dealer name.</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="editDealerStatus" class="form-label">Status</label>
                                                    <select class="form-select" id="editDealerStatus" name="status">
                                                        <option value="not-contacted">Not Contacted</option>
                                                        <option value="contacted">Contacted</option>
                                                        <option value="interested">Interested</option>
                                                        <option value="not-interested">Not Interested</option>
                                                        <option value="follow-up">Follow Up</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="editDealerPhone" class="form-label">Phone</label>
                                                    <input type="tel" class="form-control" id="editDealerPhone" name="phone" />
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="editDealerEmail" class="form-label">Email</label>
                                                    <input type="email" class="form-control" id="editDealerEmail" name="email" />
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="editDealerAddress" class="form-label">Address</label>
                                                <input type="text" class="form-control" id="editDealerAddress" name="address" />
                                            </div>
                                            <div class="mb-3">
                                                <label for="editDealerWebsite" class="form-label">Website</label>
                                                <input type="url" class="form-control" id="editDealerWebsite" name="website" />
                                            </div>
                                            <div class="mb-3">
                                                <label for="editDealerNotes" class="form-label">Notes</label>
                                                <textarea class="form-control" id="editDealerNotes" name="notes" rows="3"></textarea>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <button type="button" class="btn btn-danger" id="deleteDealerBtn">
                                                    <i class="fas fa-trash me-1"></i> Delete
                                                </button>
                                                <div>
                                                    <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                                                    <button type="submit" class="btn btn-primary">
                                                        <i class="fas fa-save me-1"></i> Save Changes
                                                    </button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    document.body.insertAdjacentHTML('beforeend', editDealerModalHtml);
                }
            })();
            
            // Initialize the edit dealer modal
            function initEditDealerModal() {
                const editDealerModal = new bootstrap.Modal(document.getElementById('editDealerModal'));
                const editDealerForm = document.getElementById('editDealerForm');
                const deleteDealerBtn = document.getElementById('deleteDealerBtn');
                
                // Form validation
                editDealerForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (!editDealerForm.checkValidity()) {
                        e.stopPropagation();
                        editDealerForm.classList.add('was-validated');
                        return;
                    }
                    
                    // Get form data
                    const formData = new FormData(editDealerForm);
                    const dealerData = Object.fromEntries(formData.entries());
                    dealerData.id = parseInt(dealerData.id);
                    
                    try {
                        // Save the dealer
                        await saveDealer(dealerData);
                        
                        // Close the modal
                        editDealerModal.hide();
                        
                        // Refresh the dealers list
                        loadDealers();
                        
                        // Show success message
                        showToast('Dealer saved successfully!', 'success');
                    } catch (error) {
                        console.error('Error saving dealer:', error);
                        showToast('Error saving dealer: ' + error.message, 'error');
                    }
                });
                
                // Delete dealer handler
                deleteDealerBtn.addEventListener('click', async function() {
                    if (confirm('Are you sure you want to delete this dealer? This action cannot be undone.')) {
                        const dealerId = parseInt(document.getElementById('editDealerId').value);
                        try {
                            await deleteDealer(dealerId);
                            editDealerModal.hide();
                            loadDealers();
                            showToast('Dealer deleted successfully!', 'success');
                        } catch (error) {
                            console.error('Error deleting dealer:', error);
                            showToast('Error deleting dealer: ' + error.message, 'error');
                        }
                    }
                });
                
                // Reset form validation on hide
                editDealerModal._element.addEventListener('hidden.bs.modal', function() {
                    editDealerForm.reset();
                    editDealerForm.classList.remove('was-validated');
                });
                
                return editDealerModal;
            }
            
            // Initialize the modal when the page loads
            document.addEventListener('DOMContentLoaded', function() {
                // Only initialize if the modal exists
                if (document.getElementById('editDealerModal')) {
                    window.editDealerModal = initEditDealerModal();
                }
            });
            
            // Save dealer to the database or local storage
            async function saveDealer(dealerData) {
                // Check if we have the dealersAdmin module
                if (window.dealersAdmin && typeof window.dealersAdmin.saveDealer === 'function') {
                    return await window.dealersAdmin.saveDealer(dealerData);
                }
                
                // Fallback to local storage
                return new Promise((resolve, reject) => {
                    try {
                        // Get existing dealers
                        const dealers = JSON.parse(localStorage.getItem('dealers') || '[]');
                        const existingIndex = dealers.findIndex(d => d.id === dealerData.id);
                        
                        // Update or add the dealer
                        if (existingIndex >= 0) {
                            // Update existing
                            dealers[existingIndex] = { ...dealers[existingIndex], ...dealerData };
                        } else {
                            // Add new
                            if (!dealerData.id) {
                                dealerData.id = Date.now(); // Generate a new ID
                            }
                            dealers.push(dealerData);
                        }
                        
                        // Save back to local storage
                        localStorage.setItem('dealers', JSON.stringify(dealers));
                        resolve(dealerData);
                    } catch (error) {
                        reject(error);
                    }
                });
            }
            
            // Delete a dealer
            async function deleteDealer(dealerId) {
                // Check if we have the dealersAdmin module
                if (window.dealersAdmin && typeof window.dealersAdmin.deleteDealer === 'function') {
                    return await window.dealersAdmin.deleteDealer(dealerId);
                }
                
                // Fallback to local storage
                return new Promise((resolve, reject) => {
                    try {
                        const dealers = JSON.parse(localStorage.getItem('dealers') || '[]');
                        const filteredDealers = dealers.filter(d => d.id !== dealerId);
                        localStorage.setItem('dealers', JSON.stringify(filteredDealers));
                        resolve(true);
                    } catch (error) {
                        reject(error);
                    }
                });
            }
            
            // Edit dealer
            async function editDealer(dealerId) {
                console.log('editDealer called with ID:', dealerId);
                
                // Convert to number if it's a string
                if (typeof dealerId === 'string') {
                    dealerId = parseInt(dealerId, 10);
                }
                
                if (isNaN(dealerId)) {
                    console.error('Invalid dealer ID:', dealerId);
                    showToast('Invalid dealer ID', 'error');
                    return;
                }
                
                try {
                    // Show loading state
                    showToast('Loading dealer data...', 'info');
                    
                    // Get the dealer data
                    const dealer = await getDealer(dealerId);
                    
                    // Populate the form
                    if (window.editDealerModal) {
                        const form = document.getElementById('editDealerForm');
                        if (form) {
                            // Reset the form first
                            form.reset();
                            
                            // Set form values
                            document.getElementById('editDealerId').value = dealer.id || '';
                            document.getElementById('editDealerName').value = dealer.name || '';
                            
                            // Set status, defaulting to 'not-contacted' if not set
                            const statusSelect = document.getElementById('editDealerStatus');
                            if (statusSelect) {
                                statusSelect.value = dealer.status || 'not-contacted';
                            }
                            
                            // Set other fields
                            document.getElementById('editDealerPhone').value = dealer.phone || '';
                            document.getElementById('editDealerEmail').value = dealer.email || '';
                            document.getElementById('editDealerAddress').value = dealer.address || '';
                            document.getElementById('editDealerWebsite').value = dealer.website || '';
                            document.getElementById('editDealerNotes').value = dealer.notes || '';
                            
                            // Show the modal
                            window.editDealerModal.show();
                            
                            // Set focus to the first input
                            const firstInput = form.querySelector('input, select, textarea');
                            if (firstInput) {
                                firstInput.focus();
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error loading dealer:', error);
                    showToast('Error loading dealer: ' + error.message, 'error');
                }
            }
            
            // Open dealer form for adding/editing
            function openDealerForm(dealer = null) {
                const modal = document.getElementById('dealerFormModal');
                const form = document.getElementById('dealerForm');
                const modalTitle = document.getElementById('dealerModalTitle');
                
                if (!modal || !form) {
                    console.error('Modal or form element not found');
                    return;
                }
                
                // Set modal title
                modalTitle.textContent = dealer ? 'Edit Dealer' : 'Add New Dealer';
                
                // Reset form
                form.reset();
                
                // Set the dealer ID as a data attribute
                if (dealer && dealer.id) {
                    form.dataset.dealerId = dealer.id;
                } else {
                    delete form.dataset.dealerId;
                }
                
                // Populate form if editing
                if (dealer) {
                    // Safely set each field value
                    const setValue = (id, value) => {
                        const el = document.getElementById(id);
                        if (el) el.value = value || '';
                    };
                    
                    setValue('dealerName', dealer.name);
                    setValue('dealerAddress', dealer.address);
                    setValue('dealerContact', dealer.contact);
                    setValue('dealerPhone', dealer.phone);
                    setValue('dealerEmail', dealer.email);
                    setValue('dealerSpecialty', dealer.specialty);
                    setValue('dealerStatus', dealer.status || 'not-contacted');
                    setValue('dealerNotes', dealer.notes);
                }
                
                // Show the modal
                const modalInstance = new bootstrap.Modal(modal);
                modalInstance.show();
            }
            
            // Save dealer (add or update)
            function saveDealer(event) {
                event.preventDefault();
                console.log('saveDealer called');
                
                const form = document.getElementById('dealerForm');
                if (!form) {
                    console.error('Form element not found');
                    return false;
                }
                
                const formData = new FormData(form);
                const dealerId = form.dataset.dealerId ? parseInt(form.dataset.dealerId) : null;
                
                // Validate required fields
                const name = formData.get('name')?.trim();
                if (!name) {
                    showToast('Dealer name is required', 'error');
                    return false;
                }
                
                // Create or update dealer object
                const dealer = {
                    id: dealerId || Date.now(), // Use existing ID or generate new one
                    name: name,
                    address: formData.get('address')?.trim() || '',
                    contact: formData.get('contact')?.trim() || '',
                    phone: formData.get('phone')?.trim() || '',
                    email: formData.get('email')?.trim() || '',
                    specialty: formData.get('specialty')?.trim() || '',
                    status: formData.get('status') || 'not-contacted',
                    notes: formData.get('notes')?.trim() || ''
                };
                
                console.log('Saving dealer:', dealer);
                
                try {
                    // Update or add the dealer
                    if (dealerId) {
                        // Update existing dealer
                        const index = dealerData.findIndex(d => d.id === dealerId);
                        if (index !== -1) {
                            // Preserve lastContact if it exists
                            dealer.lastContact = dealerData[index].lastContact;
                            dealerData[index] = dealer;
                            console.log('Updated dealer at index:', index);
                            showToast('Dealer updated successfully', 'success');
                        } else {
                            console.error('Dealer not found for update:', dealerId);
                            showToast('Error: Dealer not found', 'error');
                            return false;
                        }
                    } else {
                        // Add new dealer
                        dealerData.push(dealer);
                        console.log('Added new dealer:', dealer);
                        showToast('Dealer added successfully', 'success');
                    }
                
                    // Save to localStorage
                    if (!saveDealerData()) {
                        showToast('Error saving dealer data', 'error');
                        return false;
                    }
                    
                    // Refresh the dealer list
                    loadDealers();
                    
                    // Close the modal
                    const modalEl = document.getElementById('dealerFormModal');
                    if (modalEl) {
                        const modal = bootstrap.Modal.getInstance(modalEl);
                        if (modal) {
                            modal.hide();
                        } else {
                            // If no instance exists, create one and hide it
                            new bootstrap.Modal(modalEl).hide();
                        }
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Error saving dealer:', error);
                    showToast('Error saving dealer: ' + error.message, 'error');
                    return false;
                }
            }
            
            // Save dealer data to localStorage
            function saveDealerData() {
                try {
                    localStorage.setItem('dealerData', JSON.stringify(dealerData));
                    return true;
                } catch (error) {
                    console.error('Error saving dealer data:', error);
                    showToast('Error saving dealer data', 'error');
                    return false;
                }
            }
            
            // Format date as MM/DD/YYYY
            function formatDate(date) {
                if (!(date instanceof Date)) {
                    date = new Date(date);
                }
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
            }
            
            // Format relative date (e.g., "2 days ago")
            function formatRelativeDate(dateString) {
                if (!dateString) return 'Never contacted';
                
                const date = new Date(dateString);
                const now = new Date();
                const diffTime = now - date;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                if (isNaN(diffDays)) return 'Never contacted';
                if (diffDays === 0) return 'Today';
                if (diffDays === 1) return 'Yesterday';
                if (diffDays < 7) return diffDays + ' days ago';
                if (diffDays < 30) return Math.floor(diffDays / 7) + ' weeks ago';
                if (diffDays < 365) return Math.floor(diffDays / 30) + ' months ago';
                return Math.floor(diffDays / 365) + ' years ago';
            }
            
            // Save filter/sort preferences to localStorage
            function savePreferences() {
                const preferences = {
                    filter: currentFilter,
                    sort: currentSort,
                    search: currentSearchTerm
                };
                localStorage.setItem('dealerPreferences', JSON.stringify(preferences));
            }
            
            // Load saved preferences from localStorage
            function loadPreferences() {
                const saved = localStorage.getItem('dealerPreferences');
                if (saved) {
                    try {
                        const preferences = JSON.parse(saved);
                        currentFilter = preferences.filter || 'all';
                        currentSort = preferences.sort || 'name-asc';
                        currentSearchTerm = preferences.search || '';
                        
                        // Update UI to match saved preferences
                        if (dealerSearch) dealerSearch.value = currentSearchTerm;
                        if (sortDealers) sortDealers.value = currentSort;
                        
                        // Update active filter button
                        filterButtons.forEach(btn => {
                            if (btn.dataset.filter === currentFilter) {
                                btn.classList.add('active');
                            } else {
                                btn.classList.remove('active');
                            }
                        });
                        
                    } catch (e) {
                        console.error('Error loading preferences:', e);
                    }
                }
            }
            
            // Initialize the dealer functionality when the DOM is fully loaded
            function initializeDealerModule() {
                // Make sure the dealers list element exists
                const dealersList = document.getElementById('dealersList');
                if (!dealersList) {
                    console.error('Dealers list element not found in the DOM');
                    return;
                }
                
                // Set up the global dealersList reference
                window.dealersList = dealersList;
                
                // Initialize the dealers functionality
                initDealers();
            }
            
            // Run when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeDealerModule);
            } else {
                // DOMContentLoaded has already fired
                setTimeout(initializeDealerModule, 0);
            }
            
            // Initialize activity log when the DOM is loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initActivityLog);
            } else {
                initActivityLog();
            }
            
            // Populate the dealer select dropdown
            function populateDealerSelect() {
                if (!dealerSelect) return;
                
                dealerSelect.innerHTML = '<option value="">Select Dealer</option>';
                const sortedDealers = [...dealerData].sort((a, b) => a.name.localeCompare(b.name));
                
                sortedDealers.forEach(dealer => {
                    const option = document.createElement('option');
                    option.value = dealer.id;
                    option.textContent = dealer.name;
                    dealerSelect.appendChild(option);
                });
            }
            

            const activityLogEl = document.getElementById('activityLog');

            function getActivityIcon(type) {
                const icons = {
                    'call': '📞',
                    'email': '📧',
                    'meeting': '🤝',
                    'followup': '⏰',
                    'note': '📝'
                };
                return icons[type] || '📋';
            }
            
            function formatActivityDate(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) return 'Today';
                if (diffDays === 1) return 'Yesterday';
                if (diffDays < 7) return `${diffDays} days ago`;
                
                return date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
            }
            
            // Removed duplicate, incomplete loadActivity() block that caused an unterminated template literal
function addActivity(event) {
    event.preventDefault();
    
    const dealerId = document.getElementById('dealerSelect').value;
    const activityDate = document.getElementById('activityDate').value;
    const activityType = document.getElementById('activityType').value;
    const activityNotes = document.getElementById('activityNotes').value;
    const followUpDate = document.getElementById('followUpDate').value;
    
    if (!dealerId || !activityDate || !activityType || !activityNotes) {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    // Find the dealer
    const dealer = window.dealersAdmin?.dealers?.find(d => d.id.toString() === dealerId) || 
                  dealerData.find(d => d.id.toString() === dealerId);
                  
    if (!dealer) {
        showToast('Dealer not found', 'error');
        return;
    }
    
    // Create new activity
    const newActivity = {
        id: Date.now(),
        dealerId: parseInt(dealerId),
        dealerName: dealer.name,
        date: activityDate,
        type: activityType,
        notes: activityNotes,
        followUpDate: followUpDate || null,
        timestamp: new Date().toISOString()
    };
    
    // Add to activity log
    activityLog.unshift(newActivity);
    
    // Update dealer's last contact date and status
    const updates = {
        lastContact: activityDate
    };
    
    // If dealer status is 'Not Contacted' or not set, update to 'Contacted'
    if (!dealer.status || dealer.status === 'Not Contacted') {
        updates.status = 'Contacted';
    }
    
    // Update the dealer in the dealers admin if it exists
    if (window.dealersAdmin) {
        window.dealersAdmin.updateDealer(parseInt(dealerId), updates);
    } else {
        // Fallback to updating local dealerData
        const dealerIndex = dealerData.findIndex(d => d.id.toString() === dealerId);
        if (dealerIndex !== -1) {
            dealerData[dealerIndex] = { ...dealerData[dealerIndex], ...updates };
            localStorage.setItem('dealerData', JSON.stringify(dealerData));
        }
    }
    
    // Save activity log to localStorage
    localStorage.setItem('activityLog', JSON.stringify(activityLog));
    
    // Refresh UI
    loadActivity();
    
    // Reset form but keep the same dealer selected
    const form = document.getElementById('activityForm');
    if (form) {
        form.reset();
        document.getElementById('activityDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('dealerSelect').value = dealerId; // Keep the same dealer selected
    }
    
    showToast('Activity logged successfully', 'success');
    
    // Scroll to the top of the activity log
    const activityLogElement = document.getElementById('activityLog');
    if (activityLogElement) {
        activityLogElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

// ... (rest of the code remains the same)

// Load activity log
function loadActivity() {
    var activityLogEl = document.getElementById('activityLog');
    if (!activityLogEl) {
        return;
    }
    
    activityLogEl.innerHTML = '';
    if (!activityLog || activityLog.length === 0) {
        activityLogEl.innerHTML = '<div class="activity-item"><p>No activity recorded yet. Add your first interaction!</p></div>';
        return;
    }
    
    // Sort activities by date (newest first)
    var sortedActivities = activityLog.slice().sort(function(a, b) {
        var dateA = (a && a.date) ? new Date(a.date) : new Date(0);
        var dateB = (b && b.date) ? new Date(b.date) : new Date(0);
        return dateB - dateA;
    });
    
    // Process each activity
    for (var i = 0; i < sortedActivities.length; i++) {
        var activity = sortedActivities[i];
        if (!activity) continue;
        
        var activityEl = document.createElement('div');
        activityEl.className = 'activity-item';
        
        // Safely find the dealer
        var dealerName = 'Unknown Dealer';
        if (activity && activity.dealerId) {
            var dealer = null;
            if (window.dealersAdmin && window.dealersAdmin.dealers && Array.isArray(window.dealersAdmin.dealers)) {
                for (var j = 0; j < window.dealersAdmin.dealers.length; j++) {
                    var d = window.dealersAdmin.dealers[j];
                    if (d && d.id === activity.dealerId) {
                        dealer = d;
                        break;
                    }
                }
            } 
            
            if (!dealer && Array.isArray(dealerData)) {
                for (var k = 0; k < dealerData.length; k++) {
                    var d = dealerData[k];
                    if (d && d.id === activity.dealerId) {
                        dealer = d;
                        break;
                    }
                }
            }
            
            if (dealer && dealer.name) {
                dealerName = dealer.name;
            } else if (activity.dealerName) {
                dealerName = activity.dealerName;
            }
        }
        
        var statusClass = activity && activity.status ? 'status-' + activity.status : '';
        var statusLabel = activity && activity.status ? getStatusLabel(activity.status) : '';
        
        // Build the activity HTML
        var activityHTML = [];
        var activityDate = '';
        var activityType = (activity && activity.type) ? activity.type : '';
        
        if (activity && activity.date) {
            try {
                var dateObj = new Date(activity.date);
                if (!isNaN(dateObj.getTime())) {
                    activityDate = dateObj.toLocaleString();
                }
            } catch (e) {
                console.error('Error parsing date:', e);
            }
        }
        
        activityHTML.push('<div class="activity-header">');
        activityHTML.push('    <div class="activity-dealer">');
        activityHTML.push('        <span class="activity-type">', 
                         getActivityIcon(activityType), 
                         ' ', 
                         activityType, 
                         '</span>');
        activityHTML.push('        ', dealerName);
        activityHTML.push('    </div>');
        activityHTML.push('    <div class="activity-date" title="' + activityDate + '">');
        activityHTML.push('        ' + formatActivityDate(activity.date || ''));
        activityHTML.push('    </div>');
        activityHTML.push('</div>');
        
        // Add notes if they exist
        if (activity && activity.notes) {
            activityHTML.push('<div class="activity-notes">');
            activityHTML.push(activity.notes);
            activityHTML.push('</div>');
        }
        
        // Add status if it exists
        if (statusLabel) {
            activityHTML.push('<div class="activity-status ' + statusClass + '">');
            activityHTML.push(statusLabel);
            activityHTML.push('</div>');
        }
        
        try {
            // Set the innerHTML
            activityEl.innerHTML = activityHTML.join('');
            activityLogEl.appendChild(activityEl);
        } catch (e) {
            console.error('Error rendering activity:', e);
        }
    }
}

// ... (rest of the code remains the same)

            function getStatusLabel(status) {
                if (!status) return '';
                var labels = {
                    'contacted': '📞 Contacted',
                    'not-contacted': '⏳ Not Contacted',
                    'interested': '✅ Interested',
                    'not-interested': '❌ Not Interested',
                    'no-response': '📭 No Response'
                };
                return status in labels ? labels[status] : 'N/A';
            }

            // --- Progress Management ---
            const overallProgress = document.getElementById('overallProgress');
            let lastProgress = 0;
            
            function updateProgress() {
                try {
                    const totalCheckboxes = document.querySelectorAll('input[type="checkbox"]').length;
                    const checkedCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked').length;
                    const progress = totalCheckboxes > 0 ? Math.round((checkedCheckboxes / totalCheckboxes) * 100) : 0;
                    
                    if (!overallProgress) return;
                    
                    // Only update if progress has changed
                    if (progress !== lastProgress) {
                        // Animate progress bar
                        overallProgress.style.transition = 'width 0.5s ease-in-out, background-color 0.5s ease';
                        overallProgress.style.width = progress + '%';
                        
                        // Update progress text with animation
                        overallProgress.textContent = progress + '% Complete';
                        overallProgress.style.animation = 'pulse 0.5s ease';
                        
                        // Update progress bar color based on completion
                        if (progress < 30) {
                            overallProgress.style.backgroundColor = '#e74c3c';
                        } else if (progress < 70) {
                            overallProgress.style.backgroundColor = '#f39c12';
                        } else {
                            overallProgress.style.backgroundColor = '#2ecc71';
                        }
                        
                        // Show toast for milestone achievements
                        if (progress > 0 && progress < 100 && progress % 25 === 0) {
                            showToast('Progress: ' + progress + '% complete!', 'info');
                        } else if (progress === 100 && lastProgress < 100) {
                            showToast('🎉 All tasks completed!', 'success');
                        }
                        
                        lastProgress = progress;
                        
                        // Remove animation after it completes
                        setTimeout(function() {
                            if (overallProgress) {
                                overallProgress.style.animation = '';
                            }
                        }, 500);
                    }
                } catch (error) {
                    console.error('Error updating progress:', error);
                    showToast('Error updating progress', 'error');
                }
            }

            // --- Initialization ---
            function init() {
                loadCheckboxData();
                loadDealers();
                loadActivity();
                populateDealerSelect();
                const lastTab = localStorage.getItem('lastActiveTab') || 'overview';
                showTab(lastTab);
            }

            // Initialize the page
            init();
            
            // Initialize activity log functionality
            function initActivityLog() {
                // Set today's date as default for activity date
                const today = new Date().toISOString().split('T')[0];
                const dateInput = document.getElementById('activityDate');
                if (dateInput) {
                    dateInput.value = today;
                }
                
                // Load activities when the dealers tab is shown
                const dealersTab = document.querySelector('[data-tab="dealers"]');
                if (dealersTab) {
                    dealersTab.addEventListener('click', () => {
                        loadActivity();
                    });
                }
                
                // Load activities initially if on the dealers tab
                if (window.location.hash === '#dealers') {
                    loadActivity();
                }
            }
            
            // Load dealers from JSON file
            async function loadDealers() {
                const dealersList = document.getElementById('dealersList');
                if (!dealersList) {
                    console.error('Dealers list element not found');
                    return;
                }

                // Show loading state
                dealersList.innerHTML = `
                    <div class="d-flex justify-content-center align-items-center p-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <span class="ms-3">Loading dealer data...</span>
                    </div>`;

                try {
                    // First try to use embedded data if available
                    if (window.dealerData && window.dealerData.dealers) {
                        renderDealers(window.dealerData.dealers);
                        return;
                    }

                    // Then try to load from JSON file with relative path
                    const response = await fetch('./data/dealers.json');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const data = await response.json();
                    if (data && Array.isArray(data.dealers)) {
                        // Process dealer data - ensure all required fields exist
                        const processedDealers = data.dealers.map(dealer => ({
                            id: dealer.id || Date.now() + Math.floor(Math.random() * 1000),
                            name: dealer.name || 'Unknown Dealer',
                            address: dealer.address || '',
                            phone: dealer.phone || '',
                            email: dealer.email || '',
                            website: dealer.website || '',
                            specialty: dealer.specialty || '',
                            status: dealer.status || 'not-contacted',
                            lastContact: dealer.lastContact || '',
                            notes: dealer.notes || '',
                            contactPerson: dealer.contactPerson || ''
                        }));
                        
                        // Sort by last contact date (newest first)
                        processedDealers.sort((a, b) => {
                            const dateA = a.lastContact ? new Date(a.lastContact) : new Date(0);
                            const dateB = b.lastContact ? new Date(b.lastContact) : new Date(0);
                            return dateB - dateA;
                        });
                        
                        window.dealerData = { dealers: processedDealers };
                        
                        // Save to localStorage for offline use
                        localStorage.setItem('dealers', JSON.stringify(processedDealers));
                        
                        // Render the dealers
                        if (typeof renderDealers === 'function') {
                            renderDealers(processedDealers);
                        }
                        
                        // Update the dealer select dropdown if the function exists
                        if (typeof populateDealerSelect === 'function') {
                            populateDealerSelect();
                        }
                    } else {
                        throw new Error('Invalid dealer data format: expected an array of dealers');
                    }
                } catch (error) {
                    console.error('Error loading dealers:', error);
                    
                    // Fallback to localStorage if available
                    const savedDealers = localStorage.getItem('dealers');
                    if (savedDealers) {
                        try {
                            const dealers = JSON.parse(savedDealers);
                            if (Array.isArray(dealers)) {
                                window.dealerData = { dealers };
                                if (typeof renderDealers === 'function') {
                                    renderDealers(dealers);
                                }
                                showToast('Using cached dealer data', 'warning');
                                return;
                            }
                        } catch (e) {
                            console.error('Error parsing saved dealers:', e);
                        }
                    }
                    
                    // Last resort: use embedded data if available
                    if (window.embeddedDealerData && window.embeddedDealerData.dealers) {
                        window.dealerData = window.embeddedDealerData;
                        renderDealers(window.embeddedDealerData.dealers);
                        showToast('Using embedded dealer data', 'info');
                        return;
                    }
                    
                    // Show error state
                    dealersList.innerHTML = `
                        <div class="alert alert-danger d-flex align-items-center" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <div>
                                <h5 class="alert-heading">Failed to load dealer data</h5>
                                <p class="mb-0">${error.message || 'Please check your connection and try again.'}</p>
                                <button class="btn btn-sm btn-outline-light mt-2" onclick="loadDealers()">
                                    <i class="fas fa-sync-alt me-1"></i> Retry
                                </button>
                            </div>
                        </div>`;
                    
                    showToast('Failed to load dealer data', 'error');
                }
            }
            
            // Initialize the page when DOM is fully loaded
            function initializePage() {
                init();
                if (typeof setupCheckboxListeners === 'function') {
                    setupCheckboxListeners();
                }
                if (typeof updateCheckboxes === 'function') {
                    updateCheckboxes();
                }
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializePage);
            } else {
                // DOMContentLoaded has already fired
                initializePage();
            }
        });
    </script>
    
    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Dealer Form Modal -->
    <div class="modal fade" id="dealerFormModal" tabindex="-1" aria-labelledby="dealerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dealerModalTitle">Add New Dealer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="dealerForm" onsubmit="return saveDealer(event)">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="dealerName" class="form-label">Dealer Name *</label>
                            <input type="text" class="form-control" id="dealerName" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="dealerAddress" class="form-label">Address</label>
                            <input type="text" class="form-control" id="dealerAddress" name="address">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="dealerPhone" class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="dealerPhone" name="phone">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="dealerEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="dealerEmail" name="email">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="dealerContact" class="form-label">Contact Person</label>
                            <input type="text" class="form-control" id="dealerContact" name="contact">
                        </div>
                        <div class="mb-3">
                            <label for="dealerStatus" class="form-label">Status</label>
                            <select class="form-select" id="dealerStatus" name="status">
                                <option value="not-contacted">Not Contacted</option>
                                <option value="contacted">Contacted</option>
                                <option value="interested">Interested</option>
                                <option value="not-interested">Not Interested</option>
                                <option value="no-response">No Response</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="dealerNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="dealerNotes" name="notes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Dealer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
</html>